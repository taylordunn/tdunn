<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Predicting bike ridership: developing a model</title>

  <meta property="description" itemprop="description" content="Part 2 of predicting bike ridership in Halifax, Nova Scotia. In this post,&#10;I explore and tune different modeling approaches."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-04-29"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-04-29"/>
  <meta name="article:author" content="Taylor Dunn"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Predicting bike ridership: developing a model"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Part 2 of predicting bike ridership in Halifax, Nova Scotia. In this post,&#10;I explore and tune different modeling approaches."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Predicting bike ridership: developing a model"/>
  <meta property="twitter:description" content="Part 2 of predicting bike ridership in Halifax, Nova Scotia. In this post,&#10;I explore and tune different modeling approaches."/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Another look at measures of forecast accuracy;citation_publication_date=2006;citation_publisher=Elsevier;citation_volume=22;citation_author=Rob J Hyndman;citation_author=Anne B Koehler"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","params","categories","output","draft","bibliography"]}},"value":[{"type":"character","attributes":{},"value":["Predicting bike ridership: developing a model"]},{"type":"character","attributes":{},"value":["Part 2 of predicting bike ridership in Halifax, Nova Scotia. In this post,\nI explore and tune different modeling approaches.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Taylor Dunn"]}]}]},{"type":"character","attributes":{},"value":["2022-04-29"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["date","slug"]}},"value":[{"type":"character","attributes":{},"value":["2022-04-29"]},{"type":"NULL"}]},{"type":"character","attributes":{},"value":["R","machine learning","tidymodels","random forest","XGBoost","support-vector machine","forecasting"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["references.bib"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["predicting-bike-ridership-developing-a-model_files/anchor-4.2.2/anchor.min.js","predicting-bike-ridership-developing-a-model_files/bowser-1.9.3/bowser.min.js","predicting-bike-ridership-developing-a-model_files/distill-2.2.21/template.v2.js","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-10-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-11-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-12-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-13-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-14-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-15-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-16-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-17-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-18-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-19-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-20-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-21-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-22-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-23-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-24-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-25-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-25-2.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-26-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-27-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-28-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-30-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-32-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-33-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-39-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-40-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-41-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-42-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-43-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-44-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-45-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-46-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-46-2.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-47-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-48-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-49-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-53-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-54-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-56-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-57-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-58-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-6-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-60-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-61-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-62-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-63-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-64-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-65-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-68-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-69-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-7-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-70-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-71-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-72-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-8-1.png","predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-9-1.png","predicting-bike-ridership-developing-a-model_files/header-attrs-2.11/header-attrs.js","predicting-bike-ridership-developing-a-model_files/header-attrs-2.14/header-attrs.js","predicting-bike-ridership-developing-a-model_files/jquery-3.6.0/jquery-3.6.0.js","predicting-bike-ridership-developing-a-model_files/jquery-3.6.0/jquery-3.6.0.min.js","predicting-bike-ridership-developing-a-model_files/jquery-3.6.0/jquery-3.6.0.min.map","predicting-bike-ridership-developing-a-model_files/pagedtable-1.1/css/pagedtable.css","predicting-bike-ridership-developing-a-model_files/pagedtable-1.1/js/pagedtable.js","predicting-bike-ridership-developing-a-model_files/popper-2.6.0/popper.min.js","predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy-bundle.umd.min.js","predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy-light-border.css","predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy.css","predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy.umd.min.js","predicting-bike-ridership-developing-a-model_files/webcomponents-2.0.0/webcomponents.js","references.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="predicting-bike-ridership-developing-a-model_files/header-attrs-2.11/header-attrs.js"></script>
  <link href="predicting-bike-ridership-developing-a-model_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
  <script src="predicting-bike-ridership-developing-a-model_files/pagedtable-1.1/js/pagedtable.js"></script>
  <script src="predicting-bike-ridership-developing-a-model_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="predicting-bike-ridership-developing-a-model_files/popper-2.6.0/popper.min.js"></script>
  <link href="predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="predicting-bike-ridership-developing-a-model_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="predicting-bike-ridership-developing-a-model_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="predicting-bike-ridership-developing-a-model_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="predicting-bike-ridership-developing-a-model_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="predicting-bike-ridership-developing-a-model_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Predicting bike ridership: developing a model","description":"Part 2 of predicting bike ridership in Halifax, Nova Scotia. In this post,\nI explore and tune different modeling approaches.","authors":[{"author":"Taylor Dunn","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-04-29T00:00:00.000-04:00","citationText":"Dunn, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Predicting bike ridership: developing a model</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">R</div>
<div class="dt=tag">machine learning</div>
<div class="dt=tag">tidymodels</div>
<div class="dt=tag">random forest</div>
<div class="dt=tag">XGBoost</div>
<div class="dt=tag">support-vector machine</div>
<div class="dt=tag">forecasting</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>Part 2 of predicting bike ridership in Halifax, Nova Scotia. In
this post, I explore and tune different modeling approaches.</p></p>
</div>

<div class="d-byline">
  Taylor Dunn  
  
<br/>2022-04-29
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#exploratory-data-analysis">Exploratory data
analysis</a></li>
<li><a href="#feature-engineering">Feature engineering</a>
<ul>
<li><a href="#temperature">Temperature</a></li>
<li><a href="#precipitation-and-snow">Precipitation and snow</a></li>
<li><a href="#wind-speed">Wind speed</a></li>
<li><a href="#lagged-counts">Lagged counts</a></li>
</ul></li>
<li><a href="#modeling">Modeling</a>
<ul>
<li><a href="#resampling-and-metrics">Resampling and metrics</a></li>
<li><a href="#generalized-linear-models">Generalized linear
models</a></li>
<li><a href="#tree-based-methods">Tree-based methods</a></li>
<li><a href="#support-vector-machines">Support vector machines</a></li>
</ul></li>
<li><a href="#choosing-a-final-model">Choosing a final model</a>
<ul>
<li><a href="#exploring-the-predictions">Exploring the
predictions</a></li>
</ul></li>
<li><a href="#conclusions">Conclusions</a></li>
<li><a href="#reproducibility">Reproducibility</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Setup
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/knitr/man/opts_chunk.html'>opts_chunk</a></span><span class='op'>$</span><span class='fu'>set</span><span class='op'>(</span>echo <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gt.rstudio.com/'>gt</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/collectivemedia/tictoc'>tictoc</a></span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/taylordunn/dunnr'>dunnr</a></span><span class='op'>)</span>
<span class='fu'>extrafont</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extrafont/man/loadfonts.html'>loadfonts</a></span><span class='op'>(</span>device <span class='op'>=</span> <span class='st'>"win"</span>, quiet <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>theme_set</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/theme_td.html'>theme_td</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/set_geom_fonts.html'>set_geom_fonts</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/set_palette.html'>set_palette</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="introduction">Introduction</h2>
<p>In <a
href="../2022-04-27-predicting-bike-ridership-getting-the-data">my last
post</a>, I retrieved, explored, and prepared bike counter data from
Halifax, Nova Scotia. I also got some historical weather data to go
along with it. Here, I will further explore the data, engineer some
features, and fit and evaluate many models to predict bike ridership at
different sites around the city.</p>
<h2 id="exploratory-data-analysis">Exploratory data analysis</h2>
<p>Import the data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_rds.html'>read_rds</a></span><span class='op'>(</span><span class='st'>"bike-ridership-data.rds"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://pillar.r-lib.org/reference/glimpse.html'>glimpse</a></span><span class='op'>(</span><span class='va'>bike_ridership</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 2,840
Columns: 9
$ site_name           &lt;chr&gt; &quot;Dartmouth Harbourfront Greenway&quot;, &quot;Dart…
$ installation_date   &lt;date&gt; 2021-07-08, 2021-07-08, 2021-07-08, 202…
$ count_date          &lt;date&gt; 2021-07-08, 2021-07-09, 2021-07-10, 202…
$ n_records           &lt;int&gt; 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, …
$ n_bikes             &lt;int&gt; 130, 54, 180, 245, 208, 250, 182, 106, 1…
$ mean_temperature    &lt;dbl&gt; 18.2, 17.6, 21.0, 21.0, 20.6, 18.6, 17.7…
$ total_precipitation &lt;dbl&gt; 0.6, 10.0, 0.4, 0.0, 0.0, 0.0, 0.0, 11.6…
$ speed_max_gust      &lt;int&gt; NA, 54, 56, NA, NA, NA, NA, 32, 37, NA, …
$ snow_on_ground      &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
<p>This data consists of daily bike counts (<code>n_bikes</code>) over a
24 hour period (<code>count_date</code>) recorded at 5 sites
(<code>site_name</code>) around the city. In the original data, counts
are recorded every hour which is reflected by the <code>n_records</code>
variable:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>n_records</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="hbrjcexqeo" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hbrjcexqeo .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hbrjcexqeo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hbrjcexqeo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hbrjcexqeo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hbrjcexqeo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hbrjcexqeo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hbrjcexqeo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hbrjcexqeo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hbrjcexqeo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hbrjcexqeo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hbrjcexqeo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hbrjcexqeo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hbrjcexqeo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hbrjcexqeo .gt_from_md > :first-child {
  margin-top: 0;
}

#hbrjcexqeo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hbrjcexqeo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hbrjcexqeo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hbrjcexqeo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hbrjcexqeo .gt_row_group_first td {
  border-top-width: 2px;
}

#hbrjcexqeo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbrjcexqeo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hbrjcexqeo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hbrjcexqeo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hbrjcexqeo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbrjcexqeo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hbrjcexqeo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hbrjcexqeo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hbrjcexqeo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hbrjcexqeo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbrjcexqeo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hbrjcexqeo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbrjcexqeo .gt_left {
  text-align: left;
}

#hbrjcexqeo .gt_center {
  text-align: center;
}

#hbrjcexqeo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hbrjcexqeo .gt_font_normal {
  font-weight: normal;
}

#hbrjcexqeo .gt_font_bold {
  font-weight: bold;
}

#hbrjcexqeo .gt_font_italic {
  font-style: italic;
}

#hbrjcexqeo .gt_super {
  font-size: 65%;
}

#hbrjcexqeo .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#hbrjcexqeo .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hbrjcexqeo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hbrjcexqeo .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#hbrjcexqeo .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#hbrjcexqeo .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">site_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n_records</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Dartmouth Harbourfront Greenway</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">Dartmouth Harbourfront Greenway</td>
<td class="gt_row gt_right">48</td>
<td class="gt_row gt_right">291</td></tr>
    <tr><td class="gt_row gt_left">Hollis St</td>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">Hollis St</td>
<td class="gt_row gt_right">24</td>
<td class="gt_row gt_right">656</td></tr>
    <tr><td class="gt_row gt_left">South Park St</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">South Park St</td>
<td class="gt_row gt_right">48</td>
<td class="gt_row gt_right">884</td></tr>
    <tr><td class="gt_row gt_left">Vernon St</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">Vernon St</td>
<td class="gt_row gt_right">48</td>
<td class="gt_row gt_right">502</td></tr>
    <tr><td class="gt_row gt_left">Windsor St</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">Windsor St</td>
<td class="gt_row gt_right">48</td>
<td class="gt_row gt_right">502</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p><a
href="../2022-04-27-predicting-bike-ridership-getting-the-data/#eda-and-cleaning">All
except the Hollis St site have two channels</a> (northbound and
southbound), which is why <code>n_records</code> = 48. The entries with
fewer <code>n_records</code> reflect the time of day that the data was
extracted:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>n_records</span> <span class='op'>&lt;</span> <span class='fl'>24</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>count_date</span>, <span class='va'>n_records</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="qzbgtcijbs" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qzbgtcijbs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qzbgtcijbs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qzbgtcijbs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qzbgtcijbs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qzbgtcijbs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qzbgtcijbs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qzbgtcijbs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qzbgtcijbs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qzbgtcijbs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qzbgtcijbs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qzbgtcijbs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qzbgtcijbs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qzbgtcijbs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qzbgtcijbs .gt_from_md > :first-child {
  margin-top: 0;
}

#qzbgtcijbs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qzbgtcijbs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qzbgtcijbs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qzbgtcijbs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qzbgtcijbs .gt_row_group_first td {
  border-top-width: 2px;
}

#qzbgtcijbs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzbgtcijbs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qzbgtcijbs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qzbgtcijbs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qzbgtcijbs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzbgtcijbs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qzbgtcijbs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qzbgtcijbs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qzbgtcijbs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qzbgtcijbs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzbgtcijbs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qzbgtcijbs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzbgtcijbs .gt_left {
  text-align: left;
}

#qzbgtcijbs .gt_center {
  text-align: center;
}

#qzbgtcijbs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qzbgtcijbs .gt_font_normal {
  font-weight: normal;
}

#qzbgtcijbs .gt_font_bold {
  font-weight: bold;
}

#qzbgtcijbs .gt_font_italic {
  font-style: italic;
}

#qzbgtcijbs .gt_super {
  font-size: 65%;
}

#qzbgtcijbs .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#qzbgtcijbs .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qzbgtcijbs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qzbgtcijbs .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#qzbgtcijbs .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#qzbgtcijbs .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">site_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">count_date</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n_records</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Dartmouth Harbourfront Greenway</td>
<td class="gt_row gt_left">2022-04-25</td>
<td class="gt_row gt_right">8</td></tr>
    <tr><td class="gt_row gt_left">Hollis St</td>
<td class="gt_row gt_left">2022-04-25</td>
<td class="gt_row gt_right">4</td></tr>
    <tr><td class="gt_row gt_left">South Park St</td>
<td class="gt_row gt_left">2022-04-25</td>
<td class="gt_row gt_right">8</td></tr>
    <tr><td class="gt_row gt_left">Vernon St</td>
<td class="gt_row gt_left">2022-04-25</td>
<td class="gt_row gt_right">8</td></tr>
    <tr><td class="gt_row gt_left">Windsor St</td>
<td class="gt_row gt_left">2022-04-25</td>
<td class="gt_row gt_right">8</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>For this analysis, I will exclude this incomplete day:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'>&lt;-</span> <span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>n_records</span> <span class='op'>&gt;</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The date ranges for each site:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    min_date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>, max_date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>,
    n_days <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>, .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    site_name <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>min_date</span><span class='op'>)</span>,
    n_days_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>site_name</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>site_name</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
                          <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"n_days = "</span>, <span class='va'>n_days</span><span class='op'>)</span>, <span class='va'>n_days</span><span class='op'>)</span>,
    midpoint_date <span class='op'>=</span> <span class='va'>min_date</span> <span class='op'>+</span> <span class='va'>n_days</span> <span class='op'>/</span> <span class='fl'>2</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>site_name</span>, color <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_linerange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>min_date</span>, xmax <span class='op'>=</span> <span class='va'>max_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>min_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>max_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n_days_label</span>, x <span class='op'>=</span> <span class='va'>midpoint_date</span><span class='op'>)</span>, vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_wrap.html'>str_wrap</a></span><span class='op'>(</span><span class='va'>.</span>, width <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='cn'>NULL</span>, x <span class='op'>=</span> <span class='st'>"min_date -&gt; max_date"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-6-1.png" width="480" /></p>
</div>
<p>Before any more EDA, I’ll split the data into training and testing
sets (and only look at the training data going forward). For time series
data, there is the <code>rsample::initial_time_split()</code> function,
which I’ll use to make a 70-30 split:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Need to order by time to properly use time split</span>
<span class='va'>bike_ridership</span> <span class='op'>&lt;-</span> <span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>count_date</span>, <span class='va'>site_name</span><span class='op'>)</span>

<span class='va'>bike_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_time_split</span><span class='op'>(</span><span class='va'>bike_ridership</span>, prop <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span>

<span class='va'>bike_train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>bike_split</span><span class='op'>)</span>
<span class='va'>bike_test</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>bike_split</span><span class='op'>)</span>

<span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span>
  train <span class='op'>=</span> <span class='va'>bike_train</span>, test <span class='op'>=</span> <span class='va'>bike_test</span>, .id <span class='op'>=</span> <span class='st'>"data_set"</span>
<span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>data_set</span>, <span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    min_date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>, max_date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>,
    n_days <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>, midpoint_date <span class='op'>=</span> <span class='va'>min_date</span> <span class='op'>+</span> <span class='va'>n_days</span> <span class='op'>/</span> <span class='fl'>2</span>,
    .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>min_date</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='va'>data_set</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_linerange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>min_date</span>, xmax <span class='op'>=</span> <span class='va'>max_date</span><span class='op'>)</span>,
                 position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>min_date</span><span class='op'>)</span>, position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>max_date</span><span class='op'>)</span>, position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n_days</span>, x <span class='op'>=</span> <span class='va'>midpoint_date</span><span class='op'>)</span>, vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.5</span>,
            position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span>, show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"date range"</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>, color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<p>It might make more sense to stratify by <code>site_name</code> so
that there is a 70-30 split in each site. <a href="#fn1"
class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> For
now, I’m using a simpler approach to split into the first 70% and 30% of
the data.</p>
<p>For each site, the distribution of daily <code>n_bikes</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>n_bikes</span>, fill <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>bins <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trunc.html'>str_trunc</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='fl'>25</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<p>The South Park St site appears bimodal, which <a
href="../2022-04-27-predicting-bike-ridership-getting-the-data#eda-and-cleaning">I
noted in part 1</a> was likely due to the addition of protected bike
lanes in 2021. This can be seen more clearly in the trend over time:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span>, y <span class='op'>=</span> <span class='va'>n_bikes</span>, color <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>site_name</span>, ncol <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-9-1.png" width="576" /></p>
</div>
<p>As you would expect for data in the same city, bike counters between
sites are very highly correlated, which I can visualize:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span><span class='op'>(</span><span class='va'>count_date</span>, n_bikes1 <span class='op'>=</span> <span class='va'>n_bikes</span>,
            site_name1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trunc.html'>str_trunc</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='va'>.</span>, n_bikes2 <span class='op'>=</span> <span class='va'>n_bikes1</span>, site_name2 <span class='op'>=</span> <span class='va'>site_name1</span><span class='op'>)</span>,
            by <span class='op'>=</span> <span class='st'>"count_date"</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>site_name1</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>site_name2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>n_bikes1</span>, y <span class='op'>=</span> <span class='va'>n_bikes2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>site_name1</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='va'>site_name2</span> <span class='op'>~</span> <span class='va'>site_name1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-10-1.png" width="624" /></p>
</div>
<p>The day of the week effect looks important:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>day_of_week <span class='op'>=</span> <span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/day.html'>wday</a></span><span class='op'>(</span><span class='va'>count_date</span>, label <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>day_of_week</span>, y <span class='op'>=</span> <span class='va'>n_bikes</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_jitter.html'>geom_jitter</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span>, height <span class='op'>=</span> <span class='fl'>0</span>, width <span class='op'>=</span> <span class='fl'>0.2</span>, alpha <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/stat_summary.html'>stat_summary</a></span><span class='op'>(</span>fun <span class='op'>=</span> <span class='st'>"mean"</span>, geom <span class='op'>=</span> <span class='st'>"point"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trunc.html'>str_trunc</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='fl'>30</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>Another thing to consider is holidays. I can get Canadian holidays
with the <code>timeDate</code> package (this is how
<code>recipes::step_holiday()</code> works):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.rmetrics.org'>timeDate</a></span><span class='op'>)</span>
<span class='va'>canada_holidays</span> <span class='op'>&lt;-</span>
  <span class='fu'>timeDate</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/holiday-Listing.html'>listHolidays</a></span><span class='op'>(</span>
    pattern <span class='op'>=</span> <span class='st'>"^CA|^Christmas|^NewYears|Easter[Sun|Mon]|^GoodFriday|^CaRem"</span>
  <span class='op'>)</span>
<span class='va'>canada_holidays</span>
</code></pre>
</div>
<pre><code> [1] &quot;CACanadaDay&quot;              &quot;CACivicProvincialHoliday&quot;
 [3] &quot;CALabourDay&quot;              &quot;CaRemembranceDay&quot;        
 [5] &quot;CAThanksgivingDay&quot;        &quot;CAVictoriaDay&quot;           
 [7] &quot;ChristmasDay&quot;             &quot;ChristmasEve&quot;            
 [9] &quot;EasterMonday&quot;             &quot;EasterSunday&quot;            
[11] &quot;GoodFriday&quot;               &quot;NewYearsDay&quot;             </code></pre>
</div>
<p>Then get the dates for each across the years in the bike data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>canada_holiday_dates</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>holiday <span class='op'>=</span> <span class='va'>canada_holidays</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/expand.html'>crossing</a></span><span class='op'>(</span>year <span class='op'>=</span> <span class='fl'>2019</span><span class='op'>:</span><span class='fl'>2022</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    holiday_date <span class='op'>=</span> <span class='fu'><a href='https://purrr.tidyverse.org/reference/map2.html'>map2</a></span><span class='op'>(</span>
      <span class='va'>year</span>, <span class='va'>holiday</span>,
      <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='fu'>timeDate</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/holiday.html'>holiday</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='va'>.y</span><span class='op'>)</span><span class='op'>@</span><span class='va'>Data</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>unnest</a></span><span class='op'>(</span><span class='va'>holiday_date</span><span class='op'>)</span>

<span class='va'>canada_holiday_dates</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>holiday</span>, <span class='va'>holiday_date</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>rmarkdown</span><span class='fu'>::</span><span class='fu'><a href='https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html'>paged_table</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["holiday"],"name":[1],"type":["chr"],"align":["left"]},{"label":["holiday_date"],"name":[2],"type":["date"],"align":["right"]}],"data":[{"1":"CACanadaDay","2":"2019-07-01"},{"1":"CACanadaDay","2":"2020-07-01"},{"1":"CACanadaDay","2":"2021-07-01"},{"1":"CACanadaDay","2":"2022-07-01"},{"1":"CACivicProvincialHoliday","2":"2019-08-05"},{"1":"CACivicProvincialHoliday","2":"2020-08-03"},{"1":"CACivicProvincialHoliday","2":"2021-08-02"},{"1":"CACivicProvincialHoliday","2":"2022-08-01"},{"1":"CALabourDay","2":"2019-09-02"},{"1":"CALabourDay","2":"2020-09-07"},{"1":"CALabourDay","2":"2021-09-06"},{"1":"CALabourDay","2":"2022-09-05"},{"1":"CaRemembranceDay","2":"2019-11-11"},{"1":"CaRemembranceDay","2":"2020-11-11"},{"1":"CaRemembranceDay","2":"2021-11-11"},{"1":"CaRemembranceDay","2":"2022-11-11"},{"1":"CAThanksgivingDay","2":"2019-10-14"},{"1":"CAThanksgivingDay","2":"2020-10-12"},{"1":"CAThanksgivingDay","2":"2021-10-11"},{"1":"CAThanksgivingDay","2":"2022-10-10"},{"1":"CAVictoriaDay","2":"2019-05-20"},{"1":"CAVictoriaDay","2":"2020-05-18"},{"1":"CAVictoriaDay","2":"2021-05-24"},{"1":"CAVictoriaDay","2":"2022-05-23"},{"1":"ChristmasDay","2":"2019-12-25"},{"1":"ChristmasDay","2":"2020-12-25"},{"1":"ChristmasDay","2":"2021-12-25"},{"1":"ChristmasDay","2":"2022-12-25"},{"1":"ChristmasEve","2":"2019-12-24"},{"1":"ChristmasEve","2":"2020-12-24"},{"1":"ChristmasEve","2":"2021-12-24"},{"1":"ChristmasEve","2":"2022-12-24"},{"1":"EasterMonday","2":"2019-04-22"},{"1":"EasterMonday","2":"2020-04-13"},{"1":"EasterMonday","2":"2021-04-05"},{"1":"EasterMonday","2":"2022-04-18"},{"1":"EasterSunday","2":"2019-04-21"},{"1":"EasterSunday","2":"2020-04-12"},{"1":"EasterSunday","2":"2021-04-04"},{"1":"EasterSunday","2":"2022-04-17"},{"1":"GoodFriday","2":"2019-04-19"},{"1":"GoodFriday","2":"2020-04-10"},{"1":"GoodFriday","2":"2021-04-02"},{"1":"GoodFriday","2":"2022-04-15"},{"1":"NewYearsDay","2":"2019-01-01"},{"1":"NewYearsDay","2":"2020-01-01"},{"1":"NewYearsDay","2":"2021-01-01"},{"1":"NewYearsDay","2":"2022-01-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>Only day I can think is missing from this list is Family Day
(Heritage Day in Nova Scotia) which is the third Monday in February.
Visualize the effect of these holidays on bike ridership by plotting
<code>n_bikes</code> in a 2 week window around the holidays (showing
just the South Park St site for this plot):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>canada_holiday_dates</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>holiday_date</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-unique.html'>unique</a></span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>$</span><span class='va'>count_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    date_window <span class='op'>=</span> <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='va'>holiday_date</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.Date.html'>seq.Date</a></span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>-</span> <span class='fl'>7</span>, <span class='va'>.x</span> <span class='op'>+</span> <span class='fl'>7</span>, by <span class='op'>=</span> <span class='st'>"1 day"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>unnest</a></span><span class='op'>(</span><span class='va'>date_window</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span>
    <span class='va'>bike_train</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"date_window"</span> <span class='op'>=</span> <span class='st'>"count_date"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>is_holiday <span class='op'>=</span> <span class='va'>holiday_date</span> <span class='op'>==</span> <span class='va'>date_window</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>holiday</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>day_from_holiday <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>holiday_date</span> <span class='op'>-</span> <span class='va'>date_window</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>site_name</span> <span class='op'>==</span> <span class='st'>"South Park St"</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>day_from_holiday</span>, y <span class='op'>=</span> <span class='va'>n_bikes</span>,
             group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>holiday</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"year"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-14-1.png" width="624" /></p>
</div>
<p>The only holidays with a clear drop in ridership are Labour Day and
the Civic Holiday (called Natal Day in NS) in 2021. Victoria Day seems
to have the opposite effect. The Good Friday, Easter Sunday and Easter
Monday holidays are obviously overlapping, and the <code>n_bikes</code>
trend is a bit of a mess, but I can see an indication to the left of
Good Friday that there may be a drop in ridership going into that
weekend.</p>
<p>One thing to note is that the first, middle and last points
correspond to the same day of the week, and the middle point in this set
is usually lower than those two point, so holidays may be useful
features in conjunction with day of the week.</p>
<p>The weather variables have varying levels of completeness:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Separate out the weather data</span>
<span class='va'>weather_data</span> <span class='op'>&lt;-</span> <span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>count_date</span>, <span class='va'>mean_temperature</span>, <span class='va'>total_precipitation</span>,
           <span class='va'>speed_max_gust</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span>

<span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, <span class='va'>is.na</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='op'>-</span><span class='va'>count_date</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span>, y <span class='op'>=</span> <span class='va'>name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_tile</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='cn'>NULL</span>, x <span class='op'>=</span> <span class='cn'>NULL</span>, fill <span class='op'>=</span> <span class='st'>"Missing"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>td_colors</span><span class='op'>$</span><span class='va'>nice</span><span class='op'>$</span><span class='va'>indigo_blue</span>, <span class='st'>"gray80"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-15-1.png" width="480" /></p>
</div>
<p>The distributions:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='op'>-</span><span class='va'>count_date</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>bins <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>name</span>, nrow <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-16-1.png" width="576" /></p>
</div>
<p>For non-missing cases, plot the pairwise relationships:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='op'>-</span><span class='va'>count_date</span>, names_to <span class='op'>=</span> <span class='st'>"var1"</span>, values_to <span class='op'>=</span> <span class='st'>"val1"</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>var1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>var1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='va'>.</span>, var2 <span class='op'>=</span> <span class='va'>var1</span>, val2 <span class='op'>=</span> <span class='va'>val1</span><span class='op'>)</span>,
            by <span class='op'>=</span> <span class='st'>"count_date"</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>val1</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>val2</span><span class='op'>)</span>,
         <span class='co'># Use numeric factor labels to remove duplicates</span>
         <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>var1</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>var2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>val1</span>, y <span class='op'>=</span> <span class='va'>val2</span>, color <span class='op'>=</span> <span class='va'>var1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='va'>var2</span> <span class='op'>~</span> <span class='va'>var1</span>, scales <span class='op'>=</span> <span class='st'>"free"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<p>The clearest relationship to me is unsurprising: increasing
<code>mean_temperature</code> is associated with decreasing
<code>snow_on_ground</code> (top left plot).</p>
<p>Visualize relationships with <code>n_bikes</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>mean_temperature</span>, <span class='va'>total_precipitation</span>,
             <span class='va'>speed_max_gust</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span>,
    names_to <span class='op'>=</span> <span class='st'>"var"</span>, values_to <span class='op'>=</span> <span class='st'>"val"</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>val</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>val</span>, y <span class='op'>=</span> <span class='va'>n_bikes</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trunc.html'>str_trunc</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='fl'>15</span><span class='op'>)</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>var</span>, nrow <span class='op'>=</span> <span class='fl'>2</span>, scales <span class='op'>=</span> <span class='st'>"free_x"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='cn'>NULL</span>, color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<p>All of the weather variables seem to be have a relationship with
<code>n_bikes</code>. In terms of predictive value,
<code>mean_temperature</code> looks like it might be the most useful,
and <code>speed_max_gust</code> the least.</p>
<h2 id="feature-engineering">Feature engineering</h2>
<p>From my EDA, I decided I want try including all 4 weather variables
to predict bike ridership. This will require imputation of missing
values for all 4, which I’ll attempt here.</p>
<p>Add some more time variables for working with the
<code>weather_data</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>weather_data</span> <span class='op'>&lt;-</span> <span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>count_year <span class='op'>=</span> <span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>,
         <span class='co'># Day number relative to earliest date</span>
         count_day <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>count_date</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span><span class='op'>)</span>,
         <span class='co'># Day of the year, from 1 to 365</span>
         count_yday <span class='op'>=</span> <span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/day.html'>yday</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="temperature">Temperature</h3>
<p>The <code>mean_temperature</code> variable is missing 3% of values.
Visualize the trend over time:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>mean_temperature</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span>, y <span class='op'>=</span> <span class='va'>mean_temperature</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>count_year</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_viridis.html'>scale_color_viridis_d</a></span><span class='op'>(</span><span class='st'>"year"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span><span class='st'>"date"</span>, date_breaks <span class='op'>=</span> <span class='st'>"1 year"</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>mean_temperature</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_yday</span>, y <span class='op'>=</span> <span class='va'>mean_temperature</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>count_year</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_viridis.html'>scale_color_viridis_d</a></span><span class='op'>(</span><span class='st'>"year"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span><span class='st'>"day of year"</span>, breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>90</span>, <span class='fl'>180</span>, <span class='fl'>270</span>, <span class='fl'>365</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
<span class='va'>p1</span> <span class='op'>+</span> <span class='va'>p2</span> <span class='op'>+</span>
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>guides <span class='op'>=</span> <span class='st'>"collect"</span><span class='op'>)</span> <span class='op'>&amp;</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-20-1.png" width="624" /></p>
</div>
<p>The cyclic nature makes it a good candidate for smoothing splines. As
a starting point, try a natural spline with 5 knots on the
<code>count_yday</code> variable:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>splines</span><span class='op'>)</span>
<span class='va'>lm_temperature</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mean_temperature</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>count_yday</span>, knots <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,
      data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>weather_data</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>mean_temperature</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>p1</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='fu'>augment</span><span class='op'>(</span><span class='va'>lm_temperature</span>, newdata <span class='op'>=</span> <span class='va'>weather_data</span><span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>.fitted</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<p>We can obviously do a lot better, especially at the yearly
boundaries. I’ll fit the data using a generalized additive model (GAM)
with the <code>mgcv</code> package.<a href="#fn2" class="footnote-ref"
id="fnref2" role="doc-noteref"><sup>2</sup></a> For the
<code>count_yday</code> variable (ranges from 1-365), I’ll make sure
that there is no discontinuity between year by using a <em>cyclic</em>
spline (<code>bs = "cc"</code>). I’ll also include a smoothing term of
<code>count_day</code> which will capture the trend across years.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>mgcv</span><span class='op'>)</span>

<span class='va'>gam_temperature</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.html'>gam</a></span><span class='op'>(</span><span class='va'>mean_temperature</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/s.html'>s</a></span><span class='op'>(</span><span class='va'>count_yday</span>, bs <span class='op'>=</span> <span class='st'>"cc"</span>, k <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/s.html'>s</a></span><span class='op'>(</span><span class='va'>count_day</span><span class='op'>)</span>,
      data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>weather_data</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>mean_temperature</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>gam_temperature</span>, pages <span class='op'>=</span> <span class='fl'>1</span>, shade <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
</div>
<p>The left plot shows the seasonal trend within a year (note the lines
would connect at <code>count_yday</code> = 1 and 365), and the right
plot shows the increase in average temperature throughout time (across
years) after accounting for the seasonal effect. Overlay the fit:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p1</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='fu'>augment</span><span class='op'>(</span><span class='va'>gam_temperature</span>, newdata <span class='op'>=</span> <span class='va'>weather_data</span><span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>.fitted</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<p>I’m pretty happy with that. I’ll use predictions from this GAM to
impute missing daily temperatures.</p>
<h3 id="precipitation-and-snow">Precipitation and snow</h3>
<p>The <code>total_precipitation</code> variable is missing 36% of
values; 76% for <code>snow_on_ground</code>.</p>
<p>The <code>total_precipitation</code> distribution:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>total_precipitation <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>total_precipitation</span>, <span class='op'>-</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span>, y <span class='op'>=</span> <span class='va'>total_precipitation</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>5</span>, <span class='fl'>0</span>, <span class='fl'>20</span>, <span class='fl'>40</span>, <span class='fl'>60</span><span class='op'>)</span>,
                     labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"missing"</span>, <span class='fl'>0</span>, <span class='fl'>20</span>, <span class='fl'>40</span>, <span class='fl'>60</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p1</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-24-1.png" width="480" /></p>
</div>
<p>This pattern of missing data during winter months makes me think that
the <code>total_precipitation</code> is actually total rainfall,
i.e. snowfall is not counted. I’m going to impute the missing values
with 0 during pre-processing, which is admittedly a poor approximation
of the truth.</p>
<p>The <code>snow_on_ground</code> distribution:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>snow_on_ground <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>snow_on_ground</span>, <span class='op'>-</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span>, y <span class='op'>=</span> <span class='va'>snow_on_ground</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>0</span>, <span class='fl'>10</span>, <span class='fl'>20</span><span class='op'>)</span>,
                     labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"missing"</span>, <span class='fl'>0</span>, <span class='fl'>10</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p2</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-25-1.png" width="480" /></p>
</div>
<p>I’ll also impute zero for missing <code>snow_on_ground</code>, which
I’m a lot more confident doing here because most of the missing values
occur during non-winter months. A more careful approach might involve
imputing 0 during non-winter months that I’m certain would have no snow
on the ground, then modeling the winter months with something like a
zero-inflated Poisson model.</p>
<h3 id="wind-speed">Wind speed</h3>
<p>The <code>speed_max_gust</code> variable is the daily maximum wind
speed in km/h, and has 41% missing values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mean_speed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>weather_data</span><span class='op'>$</span><span class='va'>speed_max_gust</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>weather_data</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    speed_max_gust <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>speed_max_gust</span>, <span class='fl'>20</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span>, y <span class='op'>=</span> <span class='va'>speed_max_gust</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>.</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>speed_max_gust</span> <span class='op'>&gt;</span> <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>.</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>speed_max_gust</span> <span class='op'>&gt;</span> <span class='fl'>20</span><span class='op'>)</span>,
              method <span class='op'>=</span> <span class='st'>"loess"</span>, formula <span class='op'>=</span> <span class='st'>"y ~ x"</span>,
              color <span class='op'>=</span> <span class='va'>td_colors</span><span class='op'>$</span><span class='va'>nice</span><span class='op'>$</span><span class='va'>spanish_blue</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>mean_speed</span>,
             color <span class='op'>=</span> <span class='va'>td_colors</span><span class='op'>$</span><span class='va'>nice</span><span class='op'>$</span><span class='va'>opera_mauve</span>, size <span class='op'>=</span> <span class='fl'>1</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_jitter.html'>geom_jitter</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>.</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>speed_max_gust</span> <span class='op'>==</span> <span class='fl'>20</span><span class='op'>)</span>,
              width <span class='op'>=</span> <span class='fl'>0</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>mean_speed</span>, <span class='fl'>20</span>, <span class='fl'>40</span>, <span class='fl'>60</span>, <span class='fl'>80</span><span class='op'>)</span>,
                     labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"mean_speed"</span>, <span class='st'>"missing"</span>, <span class='fl'>40</span>, <span class='fl'>60</span>, <span class='fl'>80</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<p>Relative to the noise, the time trends are pretty minor, and the
missing data looks to be missing mostly at random. I’ll just impute
using the mean speed.</p>
<h3 id="lagged-counts">Lagged counts</h3>
<p>As a time series data set, it would be careless to not account for
past data when predicting future data, so I’ll include lagged
<code>n_bikes</code> values. Investigate the correlation in
<code>n_bikes</code> for values lagged by 1, 2 and 3 days, and by 1 and
2 weeks (because they are the same day of the week):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train_lag</span> <span class='op'>&lt;-</span> <span class='va'>bike_train</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>count_date</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    n_bikes_lag_1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='fl'>1</span><span class='op'>)</span>,
    n_bikes_lag_2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='fl'>2</span><span class='op'>)</span>,
    n_bikes_lag_3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='fl'>3</span><span class='op'>)</span>,
    n_bikes_lag_7 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='fl'>7</span><span class='op'>)</span>,
    n_bikes_lag_14 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='fl'>14</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='va'>bike_train_lag</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>count_date</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"n_bikes"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>matches</a></span><span class='op'>(</span><span class='st'>"n_bikes_lag"</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"lag_days"</span>, values_to <span class='op'>=</span> <span class='st'>"n_bikes_lag"</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>n_bikes_lag</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>lag_days <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract</a></span><span class='op'>(</span><span class='va'>lag_days</span>, <span class='st'>"\\d+"</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>lag_days</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>corr_coef <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='va'>n_bikes_lag</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>n_bikes_lag</span>, y <span class='op'>=</span> <span class='va'>n_bikes</span>, color <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_label</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>.</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>n_bikes_lag</span>, <span class='va'>site_name</span>, <span class='va'>corr_coef</span><span class='op'>)</span>,
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-round.html'>round</a></span><span class='op'>(</span><span class='va'>corr_coef</span>, <span class='fl'>2</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='fl'>500</span>, y <span class='op'>=</span> <span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>slope <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trunc.html'>str_trunc</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='fl'>8</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>lag_days</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-27-1.png" width="624" /></p>
</div>
<p>The 7- and 14-day lagged values are correlated just as strongly (in
some cases stronger) than the other options. This is great news because
I only want to include a single lag variable, and using the 14th day lag
means I can forecast 14 days ahead.</p>
<p>In order to use 14-day lag in a <code>tidymodels</code> workflow, I
need to add it to the data myself. The <code>step_lag()</code> function
won’t allow the outcome <code>n_bikes</code> to be lagged, because any
new data won’t have an <code>n_bikes</code> variable to use. See <a
href="https://www.tmwr.org/recipes.html#skip-equals-true">the warning in
this section of the Tidy Modeling with R book</a>. Add the
<code>n_bikes_lag_14</code> predictor, and exclude any values without
it:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'>&lt;-</span> <span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n_bikes_lag_14 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>n_bikes</span>, <span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>n_bikes_lag_14</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>While I’m at it, I’ll impute the missing
<code>mean_temperature</code> values with the seasonal GAM.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'>&lt;-</span> <span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    count_day <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>count_date</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span><span class='op'>)</span>,
    count_yday <span class='op'>=</span> <span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/day.html'>yday</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>,
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_cols</a></span><span class='op'>(</span>pred <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>gam_temperature</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    mean_temperature <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>mean_temperature</span><span class='op'>)</span>, <span class='va'>pred</span>,
                              <span class='va'>mean_temperature</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>count_day</span>, <span class='op'>-</span><span class='va'>count_yday</span>, <span class='op'>-</span><span class='va'>pred</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>This means I’ll have to re-split the data into training and testing
(<code>initial_time_split()</code> isn’t random, so doesn’t require
setting the seed):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'>&lt;-</span> <span class='va'>bike_ridership</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>count_date</span>, <span class='va'>site_name</span><span class='op'>)</span>

<span class='va'>bike_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_time_split</span><span class='op'>(</span><span class='va'>bike_ridership</span>, prop <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span>

<span class='va'>bike_train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>bike_split</span><span class='op'>)</span>
<span class='va'>bike_test</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>bike_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="modeling">Modeling</h2>
<p>Register parallel computing:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>n_cores</span> <span class='op'>&lt;-</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span>logical <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>doParallel</span><span class='op'>)</span>
<span class='va'>cl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makePSOCKcluster</a></span><span class='op'>(</span><span class='va'>n_cores</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></span><span class='op'>(</span><span class='va'>cl</span><span class='op'>)</span>
<span class='co'># This extra step makes sure the parallel workers have access to the</span>
<span class='co'>#  `tidyr::replace_na()` function during pre-processing, which I use later on</span>
<span class='co'># See this issue: https://github.com/tidymodels/tune/issues/364</span>
<span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/clusterApply.html'>clusterExport</a></span><span class='op'>(</span><span class='va'>cl</span>, <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"replace_na"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="resampling-and-metrics">Resampling and metrics</h3>
<p>For re-sampling, I will use <code>sliding_period()</code> to break up
the data into 14 months of data (chosen to give 10 resamples) for
analysis and 1 month for assessment:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_resamples</span> <span class='op'>&lt;-</span>
  <span class='fu'>sliding_period</span><span class='op'>(</span><span class='va'>bike_train</span>, index <span class='op'>=</span> <span class='va'>count_date</span>,
                 period <span class='op'>=</span> <span class='st'>"month"</span>, lookback <span class='op'>=</span> <span class='fl'>13</span>, assess_stop <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Visualize the resamples:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span>
  analysis_set <span class='op'>=</span> <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map_dfr</a></span><span class='op'>(</span><span class='va'>bike_resamples</span><span class='op'>$</span><span class='va'>splits</span>, <span class='va'>analysis</span>, .id <span class='op'>=</span> <span class='st'>"i"</span><span class='op'>)</span>,
  assessment_set <span class='op'>=</span> <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map_dfr</a></span><span class='op'>(</span><span class='va'>bike_resamples</span><span class='op'>$</span><span class='va'>splits</span>, <span class='va'>assessment</span>, .id <span class='op'>=</span> <span class='st'>"i"</span><span class='op'>)</span>,
  .id <span class='op'>=</span> <span class='st'>"data_set"</span>
<span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>i <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>i</span>, <span class='va'>data_set</span><span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    min_date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>, max_date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>,
    n_days <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>, midpoint_date <span class='op'>=</span> <span class='va'>min_date</span> <span class='op'>+</span> <span class='va'>n_days</span> <span class='op'>/</span> <span class='fl'>2</span>,
    .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> <span class='op'><a href='https://gt.rstudio.com/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='va'>data_set</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_linerange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>min_date</span>, xmax <span class='op'>=</span> <span class='va'>max_date</span><span class='op'>)</span>,
                 position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>min_date</span><span class='op'>)</span>, position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>max_date</span><span class='op'>)</span>, position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span><span class='fl'>0.3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"date range"</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>, color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-33-1.png" width="576" /></p>
</div>
<p>I’ll define a set of metrics to use here as well:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_metrics</span> <span class='op'>&lt;-</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span>, <span class='va'>rsq</span>, <span class='va'>mase</span>, <span class='va'>poisson_log_loss</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The Poisson log loss is a new one to me, that was <a
href="https://yardstick.tidymodels.org/news/index.html#yardstick-0-0-9-2021-11-22">recently
added to <code>yardstick</code></a>. I’ll include it just for kicks, but
I will choose my final model with <code>mase</code>, the mean absolute
scaled error, which was introduced by Hyndman and Koehler <span
class="citation" data-cites="Hyndman2006">(<a href="#ref-Hyndman2006"
role="doc-biblioref">Hyndman and Koehler 2006</a>)</span>. The MASE
involves dividing the absolute forecast error (<span
class="math inline">\(|y_i - \hat{y}_i|\)</span>) by absolute
<em>naive</em> forecast error (which involves predicting with the last
observed value). The main advantage of this is that it is scale
invariant. Mean absolute percentage error (MAPE) is the typical
scale-invariant choice in regression problems, but the MASE avoids
dividing by <code>n_bikes</code> = 0 (of which there are about 20 in
this data set). It also has a straightforward interpretation: values
greater than one indicate a worse forecast than the naive method, and
values less indicate better.</p>
<h3 id="generalized-linear-models">Generalized linear models</h3>
<p>The first models I will try are simple linear regression and Poisson
regression, but I will test out a few different pre-processing/feature
combinations. I would prefer to use negative binomial regression instead
of Poisson to account for overdispersion (see aside), but <a
href="https://github.com/tidymodels/parsnip/issues/35#issuecomment-1001088658">it
hasn’t been implemented in <code>parsnip</code> yet</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lm_spec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='st'>"lm"</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/poissonreg'>poissonreg</a></span><span class='op'>)</span> <span class='co'># This wrapper package is required to use `poisson_reg()`</span>
<span class='va'>poisson_spec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/poisson_reg.html'>poisson_reg</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='st'>"glm"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
<p>Over-dispersion in <code>n_bikes</code> (variance much higher than
the mean):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_train</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>mean_n_bikes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n_bikes</span><span class='op'>)</span>, var_n_bikes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>n_bikes</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5 × 3
  site_name                       mean_n_bikes var_n_bikes
  &lt;chr&gt;                                  &lt;dbl&gt;       &lt;dbl&gt;
1 Dartmouth Harbourfront Greenway        145.        3121.
2 Hollis St                               77.0       2180.
3 South Park St                          174.       26594.
4 Vernon St                              212.       18080.
5 Windsor St                              96.3       3413.</code></pre>
</div>
</aside>
<p>For my base pre-processing, I’ll include just <code>site_name</code>
and <code>n_bikes_lag_14</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_recipe</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>n_bikes</span> <span class='op'>~</span> <span class='va'>count_date</span> <span class='op'>+</span> <span class='va'>site_name</span> <span class='op'>+</span> <span class='va'>n_bikes_lag_14</span>,
         data <span class='op'>=</span> <span class='va'>bike_train</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>add_role</span><span class='op'>(</span><span class='va'>count_date</span>, new_role <span class='op'>=</span> <span class='st'>"date_variable"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The first extension of this recipe will include date variables. I’ll
add day of week as categorical, day of year as numerical (and tune a
natural spline function), year as numerical and Canadian holidays as
categorical.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_recipe_date</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>n_bikes</span> <span class='op'>~</span> <span class='va'>count_date</span> <span class='op'>+</span> <span class='va'>site_name</span> <span class='op'>+</span> <span class='va'>n_bikes_lag_14</span>,
         data <span class='op'>=</span> <span class='va'>bike_train</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>add_role</span><span class='op'>(</span><span class='va'>count_date</span>, new_role <span class='op'>=</span> <span class='st'>"date_variable"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_date</span><span class='op'>(</span><span class='va'>count_date</span>, features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"dow"</span>, <span class='st'>"doy"</span>, <span class='st'>"year"</span><span class='op'>)</span>,
            label <span class='op'>=</span> <span class='cn'>TRUE</span>, ordinal <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_ns</span><span class='op'>(</span><span class='va'>count_date_doy</span>, deg_free <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_holiday</span><span class='op'>(</span><span class='va'>count_date</span>, holidays <span class='op'>=</span> <span class='va'>canada_holidays</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<!-- I'll consider the weather variables, with the imputations discussed in the feature engineering section, separately: -->
<p>I’ll consider the weather variables, with the imputations discussed
in the <a href="#feature-engineering">feature engineering section</a>,
separately:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_recipe_weather</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>n_bikes</span> <span class='op'>~</span> <span class='va'>count_date</span> <span class='op'>+</span> <span class='va'>site_name</span> <span class='op'>+</span> <span class='va'>n_bikes_lag_14</span> <span class='op'>+</span> <span class='va'>mean_temperature</span> <span class='op'>+</span>
           <span class='va'>total_precipitation</span> <span class='op'>+</span> <span class='va'>speed_max_gust</span> <span class='op'>+</span> <span class='va'>snow_on_ground</span>,
         data <span class='op'>=</span> <span class='va'>bike_train</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>add_role</span><span class='op'>(</span><span class='va'>count_date</span>, new_role <span class='op'>=</span> <span class='st'>"date_variable"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='va'>speed_max_gust</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='co'># Impute these missing values with zero</span>
  <span class='fu'>step_mutate_at</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>total_precipitation</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span>,
                 fn <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>And lastly, all the features together:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_recipe_date_weather</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>n_bikes</span> <span class='op'>~</span> <span class='va'>count_date</span> <span class='op'>+</span> <span class='va'>site_name</span> <span class='op'>+</span> <span class='va'>n_bikes_lag_14</span> <span class='op'>+</span> <span class='va'>mean_temperature</span> <span class='op'>+</span>
           <span class='va'>total_precipitation</span> <span class='op'>+</span> <span class='va'>speed_max_gust</span> <span class='op'>+</span> <span class='va'>snow_on_ground</span>,
         data <span class='op'>=</span> <span class='va'>bike_train</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>add_role</span><span class='op'>(</span><span class='va'>count_date</span>, new_role <span class='op'>=</span> <span class='st'>"date_variable"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_date</span><span class='op'>(</span><span class='va'>count_date</span>, features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"dow"</span>, <span class='st'>"doy"</span>, <span class='st'>"year"</span><span class='op'>)</span>,
            label <span class='op'>=</span> <span class='cn'>TRUE</span>, ordinal <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_ns</span><span class='op'>(</span><span class='va'>count_date_doy</span>, deg_free <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_holiday</span><span class='op'>(</span><span class='va'>count_date</span>, holidays <span class='op'>=</span> <span class='va'>canada_holidays</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='va'>speed_max_gust</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_mutate_at</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>total_precipitation</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span>,
                 fn <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Put these pre-processing recipes and the model specifications into a
<code>workflow_set()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_wf_set</span> <span class='op'>&lt;-</span> <span class='fu'>workflow_set</span><span class='op'>(</span>
  preproc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>base <span class='op'>=</span> <span class='va'>glm_recipe</span>,
                 date <span class='op'>=</span> <span class='va'>glm_recipe_date</span>, weather <span class='op'>=</span> <span class='va'>glm_recipe_weather</span>,
                 date_weather <span class='op'>=</span> <span class='va'>glm_recipe_date_weather</span><span class='op'>)</span>,
  models <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>linear_reg <span class='op'>=</span> <span class='va'>lm_spec</span>, poisson_reg <span class='op'>=</span> <span class='va'>poisson_spec</span><span class='op'>)</span>,
  cross <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now fit the resamples using each combination of model specification
and pre-processing recipe:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>glm_wf_set_res</span> <span class='op'>&lt;-</span> <span class='fu'>workflow_map</span><span class='op'>(</span>
  <span class='va'>glm_wf_set</span>,
  <span class='st'>"tune_grid"</span>,
  <span class='co'># I'll try just a few `deg_free` in the spline term</span>
  grid <span class='op'>=</span> <span class='fu'>grid_regular</span><span class='op'>(</span><span class='fu'>deg_free</span><span class='op'>(</span>range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>7</span><span class='op'>)</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
  resamples <span class='op'>=</span> <span class='va'>bike_resamples</span>, metrics <span class='op'>=</span> <span class='va'>bike_metrics</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>35.22 sec elapsed</code></pre>
</div>
<p>For plotting the results this set of workflows, I’ll use a custom
plotting function with <code>rank_results()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plot_wf_set_metrics</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>wf_set_res</span>, <span class='va'>rank_metric</span> <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>wf_set_res</span>, rank_metric <span class='op'>=</span> <span class='va'>rank_metric</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>preproc <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>wflow_id</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"_"</span>, <span class='va'>model</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>rank</span>, y <span class='op'>=</span> <span class='va'>mean</span>, color <span class='op'>=</span> <span class='va'>model</span>, shape <span class='op'>=</span> <span class='va'>preproc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_errorbar</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>mean</span> <span class='op'>-</span> <span class='va'>std_err</span>, ymax <span class='op'>=</span> <span class='va'>mean</span> <span class='op'>+</span> <span class='va'>std_err</span><span class='op'>)</span>,
                  width <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>.metric</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span>
  
<span class='op'>}</span>
<span class='fu'>plot_wf_set_metrics</span><span class='op'>(</span><span class='va'>glm_wf_set_res</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-43-1.png" width="624" /></p>
</div>
<aside>
<p>I’m using my own function because the
<code>workflowsets::autoplot()</code> function doesn’t distinguish
preprocessor recipes using the names provided to the
<code>preproc</code> argument – everything just gets the name
“recipe”:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>glm_wf_set_res</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>wflow_id</span>, <span class='va'>model</span>, <span class='va'>preprocessor</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 8 × 3
  wflow_id                 preprocessor model      
  &lt;chr&gt;                    &lt;chr&gt;        &lt;chr&gt;      
1 date_weather_poisson_reg recipe       poisson_reg
2 date_weather_linear_reg  recipe       linear_reg 
3 weather_linear_reg       recipe       linear_reg 
4 date_linear_reg          recipe       linear_reg 
5 date_poisson_reg         recipe       poisson_reg
6 base_linear_reg          recipe       linear_reg 
7 weather_poisson_reg      recipe       poisson_reg
8 base_poisson_reg         recipe       poisson_reg</code></pre>
</div>
<p>My function extracts the recipe name from <code>wflow_id</code>.</p>
</aside>
<p>Across the board, the model will all the features (date and weather
predictors; indicated by the square symbols) are best, and Poisson
regression slightly outperforms linear. Here are the models ranked by
MASE: <a href="#fn3" class="footnote-ref" id="fnref3"
role="doc-noteref"><sup>3</sup></a></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>glm_wf_set_res</span>, select_best <span class='op'>=</span> <span class='cn'>TRUE</span>, rank_metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"mase"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rank</span>, <span class='va'>wflow_id</span>, <span class='va'>.config</span>, mase <span class='op'>=</span> <span class='va'>mean</span>, <span class='va'>std_err</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/fmt_number.html'>fmt_number</a></span><span class='op'>(</span>columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>mase</span>, <span class='va'>std_err</span><span class='op'>)</span>, decimals <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<div id="lviwzyiayx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lviwzyiayx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lviwzyiayx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lviwzyiayx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lviwzyiayx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lviwzyiayx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lviwzyiayx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lviwzyiayx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lviwzyiayx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lviwzyiayx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lviwzyiayx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lviwzyiayx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lviwzyiayx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lviwzyiayx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lviwzyiayx .gt_from_md > :first-child {
  margin-top: 0;
}

#lviwzyiayx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lviwzyiayx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lviwzyiayx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lviwzyiayx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lviwzyiayx .gt_row_group_first td {
  border-top-width: 2px;
}

#lviwzyiayx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lviwzyiayx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lviwzyiayx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lviwzyiayx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lviwzyiayx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lviwzyiayx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lviwzyiayx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lviwzyiayx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lviwzyiayx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lviwzyiayx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lviwzyiayx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lviwzyiayx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lviwzyiayx .gt_left {
  text-align: left;
}

#lviwzyiayx .gt_center {
  text-align: center;
}

#lviwzyiayx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lviwzyiayx .gt_font_normal {
  font-weight: normal;
}

#lviwzyiayx .gt_font_bold {
  font-weight: bold;
}

#lviwzyiayx .gt_font_italic {
  font-style: italic;
}

#lviwzyiayx .gt_super {
  font-size: 65%;
}

#lviwzyiayx .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#lviwzyiayx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#lviwzyiayx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lviwzyiayx .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#lviwzyiayx .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#lviwzyiayx .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rank</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">wflow_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.config</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std_err</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">date_weather_poisson_reg</td>
<td class="gt_row gt_left">Preprocessor2_Model1</td>
<td class="gt_row gt_right">0.469</td>
<td class="gt_row gt_right">0.041</td></tr>
    <tr><td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">date_weather_linear_reg</td>
<td class="gt_row gt_left">Preprocessor4_Model1</td>
<td class="gt_row gt_right">0.486</td>
<td class="gt_row gt_right">0.042</td></tr>
    <tr><td class="gt_row gt_right">3</td>
<td class="gt_row gt_left">weather_linear_reg</td>
<td class="gt_row gt_left">Preprocessor1_Model1</td>
<td class="gt_row gt_right">0.525</td>
<td class="gt_row gt_right">0.034</td></tr>
    <tr><td class="gt_row gt_right">4</td>
<td class="gt_row gt_left">weather_poisson_reg</td>
<td class="gt_row gt_left">Preprocessor1_Model1</td>
<td class="gt_row gt_right">0.539</td>
<td class="gt_row gt_right">0.051</td></tr>
    <tr><td class="gt_row gt_right">5</td>
<td class="gt_row gt_left">date_linear_reg</td>
<td class="gt_row gt_left">Preprocessor2_Model1</td>
<td class="gt_row gt_right">0.554</td>
<td class="gt_row gt_right">0.052</td></tr>
    <tr><td class="gt_row gt_right">6</td>
<td class="gt_row gt_left">date_poisson_reg</td>
<td class="gt_row gt_left">Preprocessor2_Model1</td>
<td class="gt_row gt_right">0.559</td>
<td class="gt_row gt_right">0.065</td></tr>
    <tr><td class="gt_row gt_right">7</td>
<td class="gt_row gt_left">base_linear_reg</td>
<td class="gt_row gt_left">Preprocessor1_Model1</td>
<td class="gt_row gt_right">0.607</td>
<td class="gt_row gt_right">0.060</td></tr>
    <tr><td class="gt_row gt_right">8</td>
<td class="gt_row gt_left">base_poisson_reg</td>
<td class="gt_row gt_left">Preprocessor1_Model1</td>
<td class="gt_row gt_right">0.704</td>
<td class="gt_row gt_right">0.061</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>So our best workflow has the id
<code>date_weather_poisson_reg</code><a href="#fn4" class="footnote-ref"
id="fnref4" role="doc-noteref"><sup>4</sup></a> with the
<code>.config</code> “Preprocessor2_Model1” which refers to a specific
spline degree from our tuning of the <code>count_date_doy</code>
feature. I can check out the results of the tuning with
<code>autoplot()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>glm_wf_set_res</span>, id <span class='op'>=</span> <span class='st'>"date_weather_poisson_reg"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>.metric</span>, nrow <span class='op'>=</span> <span class='fl'>2</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-46-1.png" width="576" /></p>
</div>
<p>The polynomial of degree 5 did best here, which I’ll use to finalize
the workflow and fit to the full training set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_poisson_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>glm_wf_set_res</span>, <span class='st'>"date_weather_poisson_reg"</span><span class='op'>)</span>,
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>glm_wf_set_res</span>, <span class='st'>"date_weather_poisson_reg"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='va'>glm_poisson_fit</span> <span class='op'>&lt;-</span> <span class='va'>glm_poisson_workflow</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="model-interpretation">Model interpretation</h4>
<p>An advantage of using a generalized linear model is that they are
easy to interpret. A simple way to estimate variable important in a GLM
is to look at the absolute value of the <span
class="math inline">\(t\)</span>-statistic (<code>statistic</code> in
the below table) – here are the top 5:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>glm_poisson_fit</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>statistic</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5 × 5
  term                     estimate std.error statistic p.value
  &lt;chr&gt;                       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 total_precipitation     -0.0380   0.000454      -83.7       0
2 site_name_South.Park.St  0.684    0.0101         68.0       0
3 site_name_Vernon.St      0.542    0.00949        57.2       0
4 mean_temperature         0.0371   0.000677       54.7       0
5 n_bikes_lag_14           0.000985 0.0000208      47.3       0</code></pre>
</div>
<p>A couple of the weather variables are among the most influential in
predicting <code>n_bikes</code>. Here are all the weather
coefficients:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>glm_poisson_fit</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>term</span>, <span class='st'>"temperature|precip|max_gust|snow"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 × 5
  term                estimate std.error statistic   p.value
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 mean_temperature     0.0371   0.000677      54.7 0        
2 total_precipitation -0.0380   0.000454     -83.7 0        
3 speed_max_gust      -0.00827  0.000373     -22.2 4.67e-109
4 snow_on_ground      -0.0619   0.00183      -33.7 2.26e-249</code></pre>
</div>
<p>Since this is a Poisson model, the link function (non-linear
relationship between the outcome and the predictors) is the
logarithm:</p>
<p><span class="math display">\[
\begin{align}
\log{n}_{\text{bikes}} &amp;= \beta_0 + \beta_1 x_1 + \dots + \beta_p
x_p \\
n_{\text{bikes}} &amp;= \text{exp}(\beta_0 + \beta_1 x_1 + \dots +
\beta_p x_p) \\
&amp;= \text{exp}(\beta_0) \text{exp}(\beta_1 x_1) \dots
\text{exp}(\beta_p x_p) \\
\end{align}
\]</span></p>
<p>So the coefficients are interpreted as: for every one unit increase
in <span class="math inline">\(x_i\)</span>, the expected value of <span
class="math inline">\(n_{\text{bikes}}\)</span> changes by
multiplicative factor of <span
class="math inline">\(\text{exp}(\beta_i)\)</span>, holding all other
predictors constant. Here are some plain-language interpretations of the
weather coefficients:</p>
<ul>
<li>For every 5°C increase in daily average temperature
(<code>mean_temperature</code>), the expected value of
<code>n_bikes</code> increases by 120%.</li>
<li>For every 10mm increase in daily rain
(<code>total_precipitation</code>), the expected value of
<code>n_bikes</code> decreases by 68%.</li>
<li>For every 10km/h increase in maximum wind speed
(<code>speed_max_gust</code>), the expected value of
<code>n_bikes</code> decreases by 92%.</li>
<li>For every 5cm of snow (<code>snow_on_ground</code>), the expected
value of <code>n_bikes</code> decreases by 73%.</li>
</ul>
<p>A more thorough and formal analysis of these types of relationships
should involve exploration of marginal effects (with a package like
<code>marginaleffects</code> for example), but I’ll move on to other
models.</p>
<h3 id="tree-based-methods">Tree-based methods</h3>
<p>For tree-based methods, I’ll use similar pre-processing as with GLM,
except I won’t use a spline term (trees partition the feature space to
capture non-linearity):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>trees_recipe</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>n_bikes</span> <span class='op'>~</span> <span class='va'>count_date</span> <span class='op'>+</span> <span class='va'>site_name</span> <span class='op'>+</span> <span class='va'>n_bikes_lag_14</span> <span class='op'>+</span> <span class='va'>mean_temperature</span> <span class='op'>+</span>
           <span class='va'>total_precipitation</span> <span class='op'>+</span> <span class='va'>speed_max_gust</span> <span class='op'>+</span> <span class='va'>snow_on_ground</span>,
         data <span class='op'>=</span> <span class='va'>bike_train</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>count_date</span>, new_role <span class='op'>=</span> <span class='st'>"date_variable"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_date</span><span class='op'>(</span><span class='va'>count_date</span>, features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"dow"</span>, <span class='st'>"doy"</span>, <span class='st'>"year"</span><span class='op'>)</span>,
            label <span class='op'>=</span> <span class='cn'>TRUE</span>, ordinal <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_holiday</span><span class='op'>(</span><span class='va'>count_date</span>, holidays <span class='op'>=</span> <span class='va'>canada_holidays</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='va'>speed_max_gust</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_mutate_at</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>total_precipitation</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span>,
                 fn <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># XGBoost requires dummy variables</span>
<span class='va'>trees_recipe_dummy</span> <span class='op'>&lt;-</span> <span class='va'>trees_recipe</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>I’ll try a decision tree, a random forest, and an XGBoost model, each
with hyperparameters indicated for tuning:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>decision_spec</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/decision_tree.html'>decision_tree</a></span><span class='op'>(</span>cost_complexity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, tree_depth <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                min_n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"rpart"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>rf_spec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/rand_forest.html'>rand_forest</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, min_n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, trees <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='co'># Setting the `importance` parameter now lets me use `vip` later</span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"ranger"</span>, importance <span class='op'>=</span> <span class='st'>"permutation"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>xgb_spec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/boost_tree.html'>boost_tree</a></span><span class='op'>(</span>
  mtry <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, trees <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, min_n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
  tree_depth <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, learn_rate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>trees_wf_set</span> <span class='op'>&lt;-</span> <span class='fu'>workflow_set</span><span class='op'>(</span>
  preproc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>trees_recipe <span class='op'>=</span> <span class='va'>trees_recipe</span>,
                 trees_recipe <span class='op'>=</span> <span class='va'>trees_recipe</span>,
                 trees_recipe_dummy <span class='op'>=</span> <span class='va'>trees_recipe_dummy</span><span class='op'>)</span>,
  models <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>rf <span class='op'>=</span> <span class='va'>rf_spec</span>, decision <span class='op'>=</span> <span class='va'>decision_spec</span>, xgb <span class='op'>=</span> <span class='va'>xgb_spec</span><span class='op'>)</span>,
  cross <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>As a first pass, I’ll let <code>tune_grid()</code> choose 10
parameter combinations automatically for each model
(<code>grid = 10</code>):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>225</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>trees_wf_set_res</span> <span class='op'>&lt;-</span> <span class='fu'>workflow_map</span><span class='op'>(</span>
  <span class='va'>trees_wf_set</span>,
  <span class='st'>"tune_grid"</span>,
  grid <span class='op'>=</span> <span class='fl'>10</span>, resamples <span class='op'>=</span> <span class='va'>bike_resamples</span>, metrics <span class='op'>=</span> <span class='va'>bike_metrics</span>,
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>119.25 sec elapsed</code></pre>
</div>
<p>Visualize the performance of the 30 workflows, ranked by MASE:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Don't need to use my custom function defined previously because I'm</span>
<span class='co'>#  not using functionally different recipes for each model</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, rank_metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-54-1.png" width="624" /></p>
</div>
<p>As I would have expected, the decision tree models generally perform
worse than random forest models (which consist of multiple decision
trees). The boosted tree models (which also consist of multiple decision
trees, but differ in how they are built and combined) slightly
outperform random forests, which is also expected.</p>
<p>For the three different tree-based model types, I’ll extract the
best-performing workflows (by MASE) and fit to the full training
set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>decision_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, <span class='st'>"trees_recipe_decision"</span><span class='op'>)</span>,
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, <span class='st'>"trees_recipe_decision"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='va'>rf_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, <span class='st'>"trees_recipe_rf"</span><span class='op'>)</span>,
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, <span class='st'>"trees_recipe_rf"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='va'>xgb_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, <span class='st'>"trees_recipe_dummy_xgb"</span><span class='op'>)</span>,
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, <span class='st'>"trees_recipe_dummy_xgb"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>decision_fit</span> <span class='op'>&lt;-</span> <span class='va'>decision_workflow</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>)</span>
<span class='va'>rf_fit</span> <span class='op'>&lt;-</span> <span class='va'>rf_workflow</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>)</span>
<span class='va'>xgb_fit</span> <span class='op'>&lt;-</span> <span class='va'>xgb_workflow</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="model-interpretation-1">Model interpretation</h4>
<p>Decision trees are the easiest of the three to interpret, but this
decision tree is quite complicated. It has 80 leaf nodes (i.e. terminal
nodes) with a depth of 10. The visualization (done with the
<code>rpart.plot</code> package) is messy and hidden below:</p>
<details>
<summary>
Decision tree plot
</summary>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/hardhat-extract.html'>extract_fit_engine</a></span><span class='op'>(</span><span class='va'>decision_fit</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>rpart.plot</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html'>rpart.plot</a></span><span class='op'>(</span>
    <span class='co'># Using some options to try and make the tree more readable</span>
    fallen.leaves <span class='op'>=</span> <span class='cn'>FALSE</span>, roundint <span class='op'>=</span> <span class='cn'>FALSE</span>,
    tweak <span class='op'>=</span> <span class='fl'>5</span>, type <span class='op'>=</span> <span class='fl'>0</span>, faclen <span class='op'>=</span> <span class='fl'>10</span>, clip.facs <span class='op'>=</span> <span class='cn'>TRUE</span>, compress <span class='op'>=</span> <span class='cn'>FALSE</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-57-1.png" width="768" /></p>
</div>
</details>
<p>The nodes at the top of the tree are a good indicator of feature
importance. Here, that was <code>n_bikes_lag_14</code>, followed by
<code>mean_temperature</code> and <code>total_precipitation</code>.</p>
<p>To quantify the contribution of each feature in a tree-based model,
we can calculate variable importance with the <code>vip</code> package.
Plot the top 5 variables for all 3 models:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/koalaverse/vip/'>vip</a></span><span class='op'>)</span>

<span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/hardhat-extract.html'>extract_fit_engine</a></span><span class='op'>(</span><span class='va'>decision_fit</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>num_features <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span><span class='cn'>NULL</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>subtitle <span class='op'>=</span> <span class='st'>"Decision tree"</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/hardhat-extract.html'>extract_fit_engine</a></span><span class='op'>(</span><span class='va'>rf_fit</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>num_features <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span><span class='cn'>NULL</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>subtitle <span class='op'>=</span> <span class='st'>"Random forest"</span><span class='op'>)</span>
<span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/hardhat-extract.html'>extract_fit_engine</a></span><span class='op'>(</span><span class='va'>xgb_fit</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>num_features <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span><span class='cn'>NULL</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>subtitle <span class='op'>=</span> <span class='st'>"XGBoost"</span><span class='op'>)</span>
<span class='va'>p1</span> <span class='op'>+</span> <span class='va'>p2</span> <span class='op'>+</span> <span class='va'>p3</span> <span class='op'>+</span>
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>ncol <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-58-1.png" width="624" /></p>
</div>
<p>We see that <code>n_bikes_lag_14</code>,
<code>mean_temperature</code>, <code>total_precipitation</code> and
<code>site_name</code> are important with all three models. Measures of
time within (<code>count_date_doy</code>) and across
(<code>count_date_year</code>) years are also important</p>
<h4 id="xgboost-tuning">XGBoost tuning</h4>
<p>So far, I’ve only considered 10 candidate sets of hyperparameters for
tuning each tree-based model. Let’s try 100 with XGBoost:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Get the number of predictors so I can set max number of predictors in `mtry()`</span>
<span class='va'>bike_train_baked</span> <span class='op'>&lt;-</span> <span class='fu'>prep</span><span class='op'>(</span><span class='va'>trees_recipe_dummy</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'>bake</span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>)</span>

<span class='co'># `grid_latin_hypercube()` is a space-filling parameter grid design that will</span>
<span class='co'>#  efficiently cover the parameter space for me</span>
<span class='va'>xgb_grid</span> <span class='op'>&lt;-</span> <span class='fu'>grid_latin_hypercube</span><span class='op'>(</span>
  <span class='fu'>finalize</span><span class='op'>(</span><span class='fu'>mtry</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>bike_train_baked</span>, <span class='op'>-</span><span class='va'>n_bikes</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/datasets/trees.html'>trees</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'>min_n</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'>tree_depth</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'>learn_rate</span><span class='op'>(</span><span class='op'>)</span>,
  size <span class='op'>=</span> <span class='fl'>100</span>
<span class='op'>)</span>
<span class='va'>xgb_grid</span>
</code></pre>
</div>
<pre><code># A tibble: 100 × 5
    mtry trees min_n tree_depth learn_rate
   &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;
 1    14   300    20          8   4.27e- 4
 2    30  1560     5         12   2.17e- 5
 3    22  1723    30          2   1.37e- 2
 4     2   268    21          2   6.42e-10
 5     7   780    15         12   1.09e- 5
 6    24   642    24          2   7.51e- 5
 7     3  1066    36          3   8.06e- 9
 8    13   725     4          6   1.94e- 2
 9    18   574    40          9   5.55e- 7
10    27  1988    38         13   7.08e- 9
# … with 90 more rows</code></pre>
</div>
<p>We have just one model and one preprocessor now, so put it into a
single <code>workflow</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_workflow_2</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>trees_recipe_dummy</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>xgb_spec</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>And tune:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>2081</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>xgb_tune</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span>
  <span class='va'>xgb_workflow_2</span>, resamples <span class='op'>=</span> <span class='va'>bike_resamples</span>,
  grid <span class='op'>=</span> <span class='va'>xgb_grid</span>, metrics <span class='op'>=</span> <span class='va'>bike_metrics</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>477.78 sec elapsed</code></pre>
</div>
<p>Here are the metrics for the different candidate models:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>xgb_tune</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-61-1.png" width="624" /></p>
</div>
<p>Finalize the workflow with the best hyperparameters and fit the full
training set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_workflow_2</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  <span class='va'>xgb_workflow_2</span>, <span class='fu'>select_best</span><span class='op'>(</span><span class='va'>xgb_tune</span>, metric <span class='op'>=</span> <span class='st'>"mase"</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>xgb_fit_2</span> <span class='op'>&lt;-</span> <span class='va'>xgb_workflow_2</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>bike_train</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="support-vector-machines">Support vector machines</h3>
<p>Lastly, I will try some support vector machine regressions with
linear, polynomial and radial basis function (RBF) kernels:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># New recipe for the SVMs which require a `step_normalize()`</span>
<span class='va'>svm_recipe</span> <span class='op'>&lt;-</span>
  <span class='fu'>recipe</span><span class='op'>(</span>
    <span class='va'>n_bikes</span> <span class='op'>~</span> <span class='va'>count_date</span> <span class='op'>+</span> <span class='va'>site_name</span> <span class='op'>+</span> <span class='va'>n_bikes_lag_14</span> <span class='op'>+</span> <span class='va'>mean_temperature</span> <span class='op'>+</span> 
      <span class='va'>total_precipitation</span> <span class='op'>+</span> <span class='va'>speed_max_gust</span> <span class='op'>+</span> <span class='va'>snow_on_ground</span>,
    data <span class='op'>=</span> <span class='va'>bike_train</span>, 
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>count_date</span>, new_role <span class='op'>=</span> <span class='st'>"date_variable"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_date</span><span class='op'>(</span><span class='va'>count_date</span>, features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"dow"</span>, <span class='st'>"doy"</span>, <span class='st'>"year"</span><span class='op'>)</span>,
            label <span class='op'>=</span> <span class='cn'>TRUE</span>, ordinal <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_holiday</span><span class='op'>(</span><span class='va'>count_date</span>, holidays <span class='op'>=</span> <span class='va'>canada_holidays</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='va'>speed_max_gust</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_mutate_at</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>total_precipitation</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span>,
                 fn <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>svm_linear_spec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/svm_linear.html'>svm_linear</a></span><span class='op'>(</span>cost <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"kernlab"</span><span class='op'>)</span>

<span class='va'>svm_poly_spec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/svm_poly.html'>svm_poly</a></span><span class='op'>(</span>cost <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                          scale_factor <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, degree <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"kernlab"</span><span class='op'>)</span>

<span class='va'>svm_rbf_spec</span> <span class='op'>&lt;-</span>  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/svm_rbf.html'>svm_rbf</a></span><span class='op'>(</span>cost <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, rbf_sigma <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"kernlab"</span><span class='op'>)</span>

<span class='va'>svm_wf_set</span> <span class='op'>&lt;-</span> <span class='fu'>workflow_set</span><span class='op'>(</span>
  preproc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>svm_recipe</span><span class='op'>)</span>,
  models <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>linear <span class='op'>=</span> <span class='va'>svm_linear_spec</span>, poly <span class='op'>=</span> <span class='va'>svm_poly_spec</span>,
                rbf <span class='op'>=</span> <span class='va'>svm_rbf_spec</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>4217</span><span class='op'>)</span>
<span class='va'>svm_wf_set_res</span> <span class='op'>&lt;-</span> <span class='fu'>workflow_map</span><span class='op'>(</span>
  <span class='va'>svm_wf_set</span>,
  <span class='st'>"tune_grid"</span>,
  grid <span class='op'>=</span> <span class='fl'>10</span>, resamples <span class='op'>=</span> <span class='va'>bike_resamples</span>, metrics <span class='op'>=</span> <span class='va'>bike_metrics</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>svm_wf_set_res</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-64-1.png" width="624" /></p>
</div>
<p>Those are some pretty interesting (and smooth) trends. The best model
is one of the <code>svm_rbf</code> candidates (though the next 10 are
the <code>svm_linear</code> models). Finalize the workflows and fit:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>svm_linear_wf_res</span> <span class='op'>&lt;-</span>
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>svm_wf_set_res</span>, <span class='st'>"recipe_linear"</span><span class='op'>)</span>
<span class='va'>svm_linear_wf</span> <span class='op'>&lt;-</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span>
    <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>svm_wf_set</span>, <span class='st'>"recipe_linear"</span><span class='op'>)</span>,
    <span class='fu'>select_best</span><span class='op'>(</span><span class='va'>svm_linear_wf_res</span>, <span class='st'>"mase"</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='va'>svm_linear_fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>svm_linear_wf</span>, <span class='va'>bike_train</span><span class='op'>)</span>

<span class='va'>svm_poly_wf_res</span> <span class='op'>&lt;-</span>
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>svm_wf_set_res</span>, <span class='st'>"recipe_poly"</span><span class='op'>)</span>
<span class='va'>svm_poly_wf</span> <span class='op'>&lt;-</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span>
    <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>svm_wf_set</span>, <span class='st'>"recipe_poly"</span><span class='op'>)</span>,
    <span class='fu'>select_best</span><span class='op'>(</span><span class='va'>svm_poly_wf_res</span>, <span class='st'>"mase"</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='va'>svm_poly_fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>svm_poly_wf</span>, <span class='va'>bike_train</span><span class='op'>)</span>

<span class='va'>svm_rbf_wf_res</span> <span class='op'>&lt;-</span>
  <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='va'>svm_wf_set_res</span>, <span class='st'>"recipe_rbf"</span><span class='op'>)</span>
<span class='va'>svm_rbf_wf</span> <span class='op'>&lt;-</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span>
    <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>svm_wf_set</span>, <span class='st'>"recipe_rbf"</span><span class='op'>)</span>,
    <span class='fu'>select_best</span><span class='op'>(</span><span class='va'>svm_rbf_wf_res</span>, <span class='st'>"mase"</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='va'>svm_rbf_fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>svm_rbf_wf</span>, <span class='va'>bike_train</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="choosing-a-final-model">Choosing a final model</h2>
<p>I’ll choose a model by the best cross-validated MASE:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span>
  <span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>glm_wf_set_res</span>, rank_metric <span class='op'>=</span> <span class='st'>"mase"</span>,
                     select_best <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
    <span class='co'># Only include the full pre-processing recipe</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>wflow_id</span>, <span class='st'>"date_weather"</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>trees_wf_set_res</span>, rank_metric <span class='op'>=</span> <span class='st'>"mase"</span>, select_best <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  <span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>svm_wf_set_res</span>, rank_metric <span class='op'>=</span> <span class='st'>"mase"</span>, select_best <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  <span class='fu'>show_best</span><span class='op'>(</span><span class='va'>xgb_tune</span>, metric <span class='op'>=</span> <span class='st'>"mase"</span>, n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>model <span class='op'>=</span> <span class='st'>"boost_tree_2"</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"mase"</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>model</span>, mase <span class='op'>=</span> <span class='va'>mean</span>, <span class='va'>std_err</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>mase</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/fmt_number.html'>fmt_number</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='va'>mase</span>, <span class='va'>std_err</span><span class='op'>)</span>, decimals <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<div id="wbxhmqklhu" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wbxhmqklhu .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wbxhmqklhu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbxhmqklhu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wbxhmqklhu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wbxhmqklhu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbxhmqklhu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbxhmqklhu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wbxhmqklhu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wbxhmqklhu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wbxhmqklhu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wbxhmqklhu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wbxhmqklhu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wbxhmqklhu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wbxhmqklhu .gt_from_md > :first-child {
  margin-top: 0;
}

#wbxhmqklhu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wbxhmqklhu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wbxhmqklhu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wbxhmqklhu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wbxhmqklhu .gt_row_group_first td {
  border-top-width: 2px;
}

#wbxhmqklhu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbxhmqklhu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wbxhmqklhu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wbxhmqklhu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbxhmqklhu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbxhmqklhu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wbxhmqklhu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wbxhmqklhu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbxhmqklhu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbxhmqklhu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbxhmqklhu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbxhmqklhu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbxhmqklhu .gt_left {
  text-align: left;
}

#wbxhmqklhu .gt_center {
  text-align: center;
}

#wbxhmqklhu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wbxhmqklhu .gt_font_normal {
  font-weight: normal;
}

#wbxhmqklhu .gt_font_bold {
  font-weight: bold;
}

#wbxhmqklhu .gt_font_italic {
  font-style: italic;
}

#wbxhmqklhu .gt_super {
  font-size: 65%;
}

#wbxhmqklhu .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#wbxhmqklhu .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#wbxhmqklhu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wbxhmqklhu .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#wbxhmqklhu .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#wbxhmqklhu .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std_err</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">boost_tree_2</td>
<td class="gt_row gt_right">0.4170</td>
<td class="gt_row gt_right">0.0431</td></tr>
    <tr><td class="gt_row gt_left">boost_tree</td>
<td class="gt_row gt_right">0.4183</td>
<td class="gt_row gt_right">0.0458</td></tr>
    <tr><td class="gt_row gt_left">rand_forest</td>
<td class="gt_row gt_right">0.4497</td>
<td class="gt_row gt_right">0.0497</td></tr>
    <tr><td class="gt_row gt_left">poisson_reg</td>
<td class="gt_row gt_right">0.4689</td>
<td class="gt_row gt_right">0.0406</td></tr>
    <tr><td class="gt_row gt_left">linear_reg</td>
<td class="gt_row gt_right">0.4860</td>
<td class="gt_row gt_right">0.0418</td></tr>
    <tr><td class="gt_row gt_left">decision_tree</td>
<td class="gt_row gt_right">0.4901</td>
<td class="gt_row gt_right">0.0574</td></tr>
    <tr><td class="gt_row gt_left">svm_rbf</td>
<td class="gt_row gt_right">0.4937</td>
<td class="gt_row gt_right">0.0452</td></tr>
    <tr><td class="gt_row gt_left">svm_linear</td>
<td class="gt_row gt_right">0.4995</td>
<td class="gt_row gt_right">0.0431</td></tr>
    <tr><td class="gt_row gt_left">svm_poly</td>
<td class="gt_row gt_right">0.5873</td>
<td class="gt_row gt_right">0.0478</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>XGBoost takes the top two spots, with <code>boost_tree_2</code> (the
more thorough tuning) being the slight winner. Perform a
<code>last_fit()</code> and get the performance on the held-out test
set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_final_fit</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span>
  <span class='va'>xgb_workflow_2</span>, split <span class='op'>=</span> <span class='va'>bike_split</span>, metrics <span class='op'>=</span> <span class='va'>bike_metrics</span>
<span class='op'>)</span>
<span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>xgb_final_fit</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 × 4
  .metric          .estimator .estimate .config             
  &lt;chr&gt;            &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse             standard      41.2   Preprocessor1_Model1
2 rsq              standard       0.567 Preprocessor1_Model1
3 mase             standard       0.611 Preprocessor1_Model1
4 poisson_log_loss standard      12.0   Preprocessor1_Model1</code></pre>
</div>
<p>There’s a bit of a drop-off in performance from the training metrics.
Let’s dig into the predictions.</p>
<h3 id="exploring-the-predictions">Exploring the predictions</h3>
<p>Plot the relationship between actual <code>n_bikes</code> and
predicted:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_final_preds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span>
  train <span class='op'>=</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>xgb_final_fit</span><span class='op'>)</span>, <span class='va'>bike_train</span><span class='op'>)</span>,
  test <span class='op'>=</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>xgb_final_fit</span><span class='op'>)</span>, <span class='va'>bike_test</span><span class='op'>)</span>,
  .id <span class='op'>=</span> <span class='st'>"data_set"</span>
<span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>data_set <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_inorder.html'>fct_inorder</a></span><span class='op'>(</span><span class='va'>data_set</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>xgb_final_preds</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>n_bikes</span>, y <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>slope <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>1</span>, color <span class='op'>=</span> <span class='va'>td_colors</span><span class='op'>$</span><span class='va'>nice</span><span class='op'>$</span><span class='va'>emerald</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>data_set</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-69-1.png" width="576" /></p>
</div>
<p>And here are the predictions overlaid on the data (vertical line
delineates training and testing sets):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>xgb_final_preds</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>n_bikes</span>, color <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>bike_test</span><span class='op'>$</span><span class='va'>count_date</span><span class='op'>)</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>site_name</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>600</span>, <span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expand_limits.html'>expand_limits</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='fl'>200</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>p</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-70-1.png" width="624" /></p>
</div>
<p>Truncate the dates to look closer at the testing set performance:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span>xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"2021-07-01"</span>, <span class='st'>"2022-05-01"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-71-1.png" width="624" data-distill-preview=1 /></p>
</div>
<p>This looks okay to my eye, though it does look to be overfitting the
training set. It’s a shame to not have more data to test a full year –
most of the test set covers winter and spring. <a href="#fn5"
class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>To investigate the model performance further, I’ll plot the biggest
outliers in the training and testing set (and ±1 week on either
side):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>worst_preds</span> <span class='op'>&lt;-</span> <span class='va'>xgb_final_preds</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>abs_error <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>n_bikes</span> <span class='op'>-</span> <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>data_set</span>, <span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span><span class='va'>abs_error</span>, n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>data_set</span>, <span class='va'>site_name</span>, <span class='va'>count_date</span>, <span class='va'>n_bikes</span>, <span class='va'>.pred</span>, <span class='va'>abs_error</span><span class='op'>)</span>

<span class='va'>site_colors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span><span class='va'>td_colors</span><span class='op'>$</span><span class='va'>pastel6</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span>, <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-unique.html'>unique</a></span><span class='op'>(</span><span class='va'>worst_preds</span><span class='op'>$</span><span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>worst_preds</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>data_set</span>, <span class='va'>site_name</span>, <span class='va'>count_date</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    worst_date <span class='op'>=</span> <span class='va'>count_date</span>,
    count_date <span class='op'>=</span> <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='va'>count_date</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.Date.html'>seq.Date</a></span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>-</span> <span class='fl'>7</span>, <span class='va'>.x</span> <span class='op'>+</span> <span class='fl'>7</span>, by <span class='op'>=</span> <span class='st'>"day"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>unnest</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>xgb_final_preds</span>,
            by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-c.html'>c</a></span><span class='op'>(</span><span class='st'>"data_set"</span>, <span class='st'>"site_name"</span>, <span class='st'>"count_date"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>n_bikes</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>site_name <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_inorder.html'>fct_inorder</a></span><span class='op'>(</span><span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/base/split.html'>split</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>$</span><span class='va'>site_name</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span>
    <span class='op'>~</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>n_bikes</span>, color <span class='op'>=</span> <span class='va'>site_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='va'>worst_date</span><span class='op'>)</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>data_set</span>, scales <span class='op'>=</span> <span class='st'>"free_x"</span>, ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>dunnr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dunnr/man/add_facet_borders.html'>add_facet_borders</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>site_colors</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/timeDate/man/base-unique.html'>unique</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>$</span><span class='va'>worst_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expand_limits.html'>expand_limits</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='cn'>NULL</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>,
           subtitle <span class='op'>=</span> <span class='va'>.</span><span class='op'>$</span><span class='va'>site_name</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://purrr.tidyverse.org/reference/reduce.html'>reduce</a></span><span class='op'>(</span><span class='va'>`+`</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="predicting-bike-ridership-developing-a-model_files/figure-html5/unnamed-chunk-72-1.png" width="624" /></p>
</div>
<aside>
<p>The Vernon St site has 6 dates with <code>n_bikes = 0</code> all in a
row:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>site_name</span> <span class='op'>==</span> <span class='st'>"Vernon St"</span>, <span class='va'>n_bikes</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>count_date</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;2021-11-13&quot; &quot;2021-11-14&quot; &quot;2021-11-15&quot; &quot;2021-11-16&quot; &quot;2021-11-17&quot;
[6] &quot;2021-11-18&quot;</code></pre>
</div>
</aside>
<p>Relative to the noise in the data, that doesn’t look too bad. The
Vernon St site has a series of <code>n_bikes</code> = 0 in a row that
I’m guessing aren’t real (see aside). It was probably an issue with the
counter, or maybe some construction on the street halting traffic for
that period.</p>
<p>I also think some of the poor predictions can be explained by missing
data. For instance, there are some poor predictions around 2021-11-23,
where the model is over-estimating <code>n_bikes</code> at a few sites.
Check out the weather around that day:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bike_ridership</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>count_date</span> <span class='op'>&gt;</span> <span class='st'>"2021-11-20"</span>, <span class='va'>count_date</span> <span class='op'>&lt;</span> <span class='st'>"2021-11-26"</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>count_date</span>, <span class='va'>mean_temperature</span>, <span class='va'>total_precipitation</span>,
           <span class='va'>speed_max_gust</span>, <span class='va'>snow_on_ground</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="mdfisbbvvs" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#mdfisbbvvs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mdfisbbvvs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mdfisbbvvs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mdfisbbvvs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mdfisbbvvs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mdfisbbvvs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mdfisbbvvs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mdfisbbvvs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mdfisbbvvs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mdfisbbvvs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mdfisbbvvs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mdfisbbvvs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#mdfisbbvvs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mdfisbbvvs .gt_from_md > :first-child {
  margin-top: 0;
}

#mdfisbbvvs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mdfisbbvvs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mdfisbbvvs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mdfisbbvvs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mdfisbbvvs .gt_row_group_first td {
  border-top-width: 2px;
}

#mdfisbbvvs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mdfisbbvvs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mdfisbbvvs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mdfisbbvvs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mdfisbbvvs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mdfisbbvvs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mdfisbbvvs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mdfisbbvvs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mdfisbbvvs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mdfisbbvvs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mdfisbbvvs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mdfisbbvvs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mdfisbbvvs .gt_left {
  text-align: left;
}

#mdfisbbvvs .gt_center {
  text-align: center;
}

#mdfisbbvvs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mdfisbbvvs .gt_font_normal {
  font-weight: normal;
}

#mdfisbbvvs .gt_font_bold {
  font-weight: bold;
}

#mdfisbbvvs .gt_font_italic {
  font-style: italic;
}

#mdfisbbvvs .gt_super {
  font-size: 65%;
}

#mdfisbbvvs .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#mdfisbbvvs .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#mdfisbbvvs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mdfisbbvvs .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#mdfisbbvvs .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#mdfisbbvvs .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">count_date</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mean_temperature</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">total_precipitation</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">speed_max_gust</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">snow_on_ground</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">2021-11-21</td>
<td class="gt_row gt_right">3.2</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">2</td></tr>
    <tr><td class="gt_row gt_left">2021-11-22</td>
<td class="gt_row gt_right">11.1</td>
<td class="gt_row gt_right">42.2</td>
<td class="gt_row gt_right">57</td>
<td class="gt_row gt_right">2</td></tr>
    <tr><td class="gt_row gt_left">2021-11-23</td>
<td class="gt_row gt_right">6.1</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">41</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">2021-11-24</td>
<td class="gt_row gt_right">0.1</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">43</td>
<td class="gt_row gt_right">1</td></tr>
    <tr><td class="gt_row gt_left">2021-11-25</td>
<td class="gt_row gt_right">3.7</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">43</td>
<td class="gt_row gt_right">1</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>This happens to be around the time of <a
href="https://globalnews.ca/news/8395034/ns-storm-closures-2021/">a huge
rain and wind storm in Nova Scotia</a> that knocked out power for a lot
of people. This is seen in the <code>total_precipitation</code> on
2021-11-22, but the next day is missing data so, in my pre-processing,
it was imputed as 0, which is definitely a poor approximation of the
truth. If I impute a large amount of rain (let’s say 40mm) for that
date, here is how the predictions change:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span>
  <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='va'>xgb_final_fit</span><span class='op'>)</span>,
  <span class='va'>xgb_final_preds</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>count_date</span> <span class='op'>==</span> <span class='st'>"2021-11-23"</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>.pred_old <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>total_precipitation <span class='op'>=</span> <span class='fl'>40</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>site_name</span>, <span class='va'>n_bikes</span>, <span class='va'>.pred_old</span>, .pred_new <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5 × 4
  site_name                       n_bikes .pred_old .pred_new
  &lt;chr&gt;                             &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Dartmouth Harbourfront Greenway      30     116.       69.4
2 Hollis St                            19      82.3      54.4
3 South Park St                        59     273.      157. 
4 Vernon St                           133     186.      115. 
5 Windsor St                           26     105.       67.4</code></pre>
</div>
<p>That is a much better prediction for a rainy and windy day.</p>
<h2 id="conclusions">Conclusions</h2>
<p>In the end, the XGBoost model was able to best predict bike ridership
this data set.</p>
<p>Is this model useful to anyone? Maybe. Is it useful just sitting on
my computer? Definitely not. So in <a
href="../2022-05-19-predicting-bike-ridership-deploying-the-model/">my
next post</a>, I’ll put this model into production.</p>
<h2 class="appendix" id="reproducibility">Reproducibility</h2>
<details>
<summary>
Session info
</summary>
<div class="layout-chunk" data-layout="l-body">
<pre><code> setting  value                            
 version  R version 4.2.0 (2022-04-22 ucrt)
 os       Windows 10 x64                   
 system   x86_64, mingw32                  
 ui       RTerm                            
 language (EN)                             
 collate  English_Canada.utf8              
 ctype    English_Canada.utf8              
 tz       America/Curacao                  
 date     2022-05-27                       </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["package"],"name":[1],"type":["chr"],"align":["left"]},{"label":["ondiskversion"],"name":[2],"type":["chr"],"align":["left"]},{"label":["loadedversion"],"name":[3],"type":["chr"],"align":["left"]},{"label":["path"],"name":[4],"type":["chr"],"align":["left"]},{"label":["loadedpath"],"name":[5],"type":["chr"],"align":["left"]},{"label":["attached"],"name":[6],"type":["lgl"],"align":["right"]},{"label":["is_base"],"name":[7],"type":["lgl"],"align":["right"]},{"label":["date"],"name":[8],"type":["chr"],"align":["left"]},{"label":["source"],"name":[9],"type":["chr"],"align":["left"]},{"label":["md5ok"],"name":[10],"type":["lgl"],"align":["right"]},{"label":["library"],"name":[11],"type":["fct"],"align":["left"]}],"data":[{"1":"assertthat","2":"0.2.1","3":"0.2.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/assertthat","5":"C:/Users/tdunn/Documents/R/win-library/4.1/assertthat","6":"FALSE","7":"FALSE","8":"2019-03-21","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"assertthat"},{"1":"backports","2":"1.2.1","3":"1.2.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/backports","5":"C:/Users/tdunn/Documents/R/win-library/4.1/backports","6":"FALSE","7":"FALSE","8":"2020-12-09","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"backports"},{"1":"broom","2":"0.8.0","3":"0.8.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/broom","5":"C:/Users/tdunn/Documents/R/win-library/4.1/broom","6":"TRUE","7":"FALSE","8":"2022-04-13","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"broom"},{"1":"bslib","2":"0.3.1","3":"0.3.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/bslib","5":"C:/Users/tdunn/Documents/R/win-library/4.1/bslib","6":"FALSE","7":"FALSE","8":"2021-10-06","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"bslib"},{"1":"cachem","2":"1.0.6","3":"1.0.6","4":"C:/Users/tdunn/Documents/R/win-library/4.1/cachem","5":"C:/Users/tdunn/Documents/R/win-library/4.1/cachem","6":"FALSE","7":"FALSE","8":"2021-08-19","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"cachem"},{"1":"callr","2":"3.7.0","3":"3.7.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/callr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/callr","6":"FALSE","7":"FALSE","8":"2021-04-20","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"callr"},{"1":"cellranger","2":"1.1.0","3":"1.1.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/cellranger","5":"C:/Users/tdunn/Documents/R/win-library/4.1/cellranger","6":"FALSE","7":"FALSE","8":"2016-07-27","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"cellranger"},{"1":"checkmate","2":"2.0.0","3":"2.0.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/checkmate","5":"C:/Users/tdunn/Documents/R/win-library/4.1/checkmate","6":"FALSE","7":"FALSE","8":"2020-02-06","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"checkmate"},{"1":"class","2":"7.3.20","3":"7.3-20","4":"C:/Program Files/R/R-4.2.0/library/class","5":"C:/Program Files/R/R-4.2.0/library/class","6":"FALSE","7":"FALSE","8":"2022-01-16","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"class"},{"1":"cli","2":"3.2.0","3":"3.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/cli","5":"C:/Users/tdunn/Documents/R/win-library/4.1/cli","6":"FALSE","7":"FALSE","8":"2022-02-14","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"cli"},{"1":"codetools","2":"0.2.18","3":"0.2-18","4":"C:/Program Files/R/R-4.2.0/library/codetools","5":"C:/Program Files/R/R-4.2.0/library/codetools","6":"FALSE","7":"FALSE","8":"2020-11-04","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"codetools"},{"1":"colorspace","2":"2.0.3","3":"2.0-3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/colorspace","5":"C:/Users/tdunn/Documents/R/win-library/4.1/colorspace","6":"FALSE","7":"FALSE","8":"2022-02-21","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"colorspace"},{"1":"crayon","2":"1.5.1","3":"1.5.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/crayon","5":"C:/Users/tdunn/Documents/R/win-library/4.1/crayon","6":"FALSE","7":"FALSE","8":"2022-03-26","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"crayon"},{"1":"data.table","2":"1.14.0","3":"1.14.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/data.table","5":"C:/Users/tdunn/Documents/R/win-library/4.1/data.table","6":"FALSE","7":"FALSE","8":"2021-02-21","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"data.table"},{"1":"DBI","2":"1.1.2","3":"1.1.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/DBI","5":"C:/Users/tdunn/Documents/R/win-library/4.1/DBI","6":"FALSE","7":"FALSE","8":"2021-12-20","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"DBI"},{"1":"dbplyr","2":"2.1.1","3":"2.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/dbplyr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/dbplyr","6":"FALSE","7":"FALSE","8":"2021-04-06","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"dbplyr"},{"1":"desc","2":"1.4.0","3":"1.4.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/desc","5":"C:/Users/tdunn/Documents/R/win-library/4.1/desc","6":"FALSE","7":"FALSE","8":"2021-09-28","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"desc"},{"1":"devtools","2":"2.4.3","3":"2.4.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/devtools","5":"C:/Users/tdunn/Documents/R/win-library/4.1/devtools","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"devtools"},{"1":"dials","2":"0.1.1","3":"0.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/dials","5":"C:/Users/tdunn/Documents/R/win-library/4.1/dials","6":"TRUE","7":"FALSE","8":"2022-04-06","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"dials"},{"1":"DiceDesign","2":"1.9","3":"1.9","4":"C:/Users/tdunn/Documents/R/win-library/4.1/DiceDesign","5":"C:/Users/tdunn/Documents/R/win-library/4.1/DiceDesign","6":"FALSE","7":"FALSE","8":"2021-02-13","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"DiceDesign"},{"1":"digest","2":"0.6.29","3":"0.6.29","4":"C:/Users/tdunn/Documents/R/win-library/4.1/digest","5":"C:/Users/tdunn/Documents/R/win-library/4.1/digest","6":"FALSE","7":"FALSE","8":"2021-12-01","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"digest"},{"1":"distill","2":"1.3","3":"1.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/distill","5":"C:/Users/tdunn/Documents/R/win-library/4.1/distill","6":"FALSE","7":"FALSE","8":"2021-10-13","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"distill"},{"1":"doParallel","2":"1.0.16","3":"1.0.16","4":"C:/Users/tdunn/Documents/R/win-library/4.1/doParallel","5":"C:/Users/tdunn/Documents/R/win-library/4.1/doParallel","6":"TRUE","7":"FALSE","8":"2020-10-16","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"doParallel"},{"1":"downlit","2":"0.4.0","3":"0.4.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/downlit","5":"C:/Users/tdunn/Documents/R/win-library/4.1/downlit","6":"FALSE","7":"FALSE","8":"2021-10-29","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"downlit"},{"1":"dplyr","2":"1.0.8","3":"1.0.8","4":"C:/Users/tdunn/Documents/R/win-library/4.1/dplyr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/dplyr","6":"TRUE","7":"FALSE","8":"2022-02-08","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"dplyr"},{"1":"dunnr","2":"0.2.5","3":"0.2.5","4":"C:/Users/tdunn/Documents/R/win-library/4.1/dunnr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/dunnr","6":"TRUE","7":"FALSE","8":"2022-01-15","9":"Github (taylordunn/dunnr@c83b30e)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"dunnr"},{"1":"ellipsis","2":"0.3.2","3":"0.3.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/ellipsis","5":"C:/Users/tdunn/Documents/R/win-library/4.1/ellipsis","6":"FALSE","7":"FALSE","8":"2021-04-29","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"ellipsis"},{"1":"evaluate","2":"0.14","3":"0.14","4":"C:/Users/tdunn/Documents/R/win-library/4.1/evaluate","5":"C:/Users/tdunn/Documents/R/win-library/4.1/evaluate","6":"FALSE","7":"FALSE","8":"2019-05-28","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"evaluate"},{"1":"extrafont","2":"0.17","3":"0.17","4":"C:/Users/tdunn/Documents/R/win-library/4.1/extrafont","5":"C:/Users/tdunn/Documents/R/win-library/4.1/extrafont","6":"FALSE","7":"FALSE","8":"2014-12-08","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"extrafont"},{"1":"extrafontdb","2":"1.0","3":"1.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/extrafontdb","5":"C:/Users/tdunn/Documents/R/win-library/4.1/extrafontdb","6":"FALSE","7":"FALSE","8":"2012-06-11","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"extrafontdb"},{"1":"fansi","2":"1.0.3","3":"1.0.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/fansi","5":"C:/Users/tdunn/Documents/R/win-library/4.1/fansi","6":"FALSE","7":"FALSE","8":"2022-03-24","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"fansi"},{"1":"farver","2":"2.1.0","3":"2.1.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/farver","5":"C:/Users/tdunn/Documents/R/win-library/4.1/farver","6":"FALSE","7":"FALSE","8":"2021-02-28","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"farver"},{"1":"fastmap","2":"1.1.0","3":"1.1.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/fastmap","5":"C:/Users/tdunn/Documents/R/win-library/4.1/fastmap","6":"FALSE","7":"FALSE","8":"2021-01-25","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"fastmap"},{"1":"forcats","2":"0.5.1","3":"0.5.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/forcats","5":"C:/Users/tdunn/Documents/R/win-library/4.1/forcats","6":"TRUE","7":"FALSE","8":"2021-01-27","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"forcats"},{"1":"foreach","2":"1.5.2","3":"1.5.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/foreach","5":"C:/Users/tdunn/Documents/R/win-library/4.1/foreach","6":"TRUE","7":"FALSE","8":"2022-02-02","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"foreach"},{"1":"fs","2":"1.5.2","3":"1.5.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/fs","5":"C:/Users/tdunn/Documents/R/win-library/4.1/fs","6":"FALSE","7":"FALSE","8":"2021-12-08","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"fs"},{"1":"furrr","2":"0.2.3","3":"0.2.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/furrr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/furrr","6":"FALSE","7":"FALSE","8":"2021-06-25","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"furrr"},{"1":"future","2":"1.24.0","3":"1.24.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/future","5":"C:/Users/tdunn/Documents/R/win-library/4.1/future","6":"FALSE","7":"FALSE","8":"2022-02-19","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"future"},{"1":"future.apply","2":"1.8.1","3":"1.8.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/future.apply","5":"C:/Users/tdunn/Documents/R/win-library/4.1/future.apply","6":"FALSE","7":"FALSE","8":"2021-08-10","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"future.apply"},{"1":"generics","2":"0.1.2","3":"0.1.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/generics","5":"C:/Users/tdunn/Documents/R/win-library/4.1/generics","6":"FALSE","7":"FALSE","8":"2022-01-31","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"generics"},{"1":"ggplot2","2":"3.3.5","3":"3.3.5","4":"C:/Users/tdunn/Documents/R/win-library/4.1/ggplot2","5":"C:/Users/tdunn/Documents/R/win-library/4.1/ggplot2","6":"TRUE","7":"FALSE","8":"2021-06-25","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"ggplot2"},{"1":"ggrepel","2":"0.9.1","3":"0.9.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/ggrepel","5":"C:/Users/tdunn/Documents/R/win-library/4.1/ggrepel","6":"FALSE","7":"FALSE","8":"2021-01-15","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"ggrepel"},{"1":"globals","2":"0.14.0","3":"0.14.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/globals","5":"C:/Users/tdunn/Documents/R/win-library/4.1/globals","6":"FALSE","7":"FALSE","8":"2020-11-22","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"globals"},{"1":"glue","2":"1.6.2","3":"1.6.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/glue","5":"C:/Users/tdunn/Documents/R/win-library/4.1/glue","6":"FALSE","7":"FALSE","8":"2022-02-24","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"glue"},{"1":"gower","2":"0.2.2","3":"0.2.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/gower","5":"C:/Users/tdunn/Documents/R/win-library/4.1/gower","6":"FALSE","7":"FALSE","8":"2020-06-23","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"gower"},{"1":"GPfit","2":"1.0.8","3":"1.0-8","4":"C:/Users/tdunn/Documents/R/win-library/4.1/GPfit","5":"C:/Users/tdunn/Documents/R/win-library/4.1/GPfit","6":"FALSE","7":"FALSE","8":"2019-02-08","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"GPfit"},{"1":"gridExtra","2":"2.3","3":"2.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/gridExtra","5":"C:/Users/tdunn/Documents/R/win-library/4.1/gridExtra","6":"FALSE","7":"FALSE","8":"2017-09-09","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"gridExtra"},{"1":"gt","2":"0.5.0","3":"0.5.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/gt","5":"C:/Users/tdunn/Documents/R/win-library/4.1/gt","6":"TRUE","7":"FALSE","8":"2022-04-21","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"gt"},{"1":"gtable","2":"0.3.0","3":"0.3.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/gtable","5":"C:/Users/tdunn/Documents/R/win-library/4.1/gtable","6":"FALSE","7":"FALSE","8":"2019-03-25","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"gtable"},{"1":"hardhat","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/hardhat","5":"C:/Users/tdunn/Documents/R/win-library/4.1/hardhat","6":"FALSE","7":"FALSE","8":"2022-01-24","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"hardhat"},{"1":"haven","2":"2.4.1","3":"2.4.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/haven","5":"C:/Users/tdunn/Documents/R/win-library/4.1/haven","6":"FALSE","7":"FALSE","8":"2021-04-23","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"haven"},{"1":"highr","2":"0.9","3":"0.9","4":"C:/Users/tdunn/Documents/R/win-library/4.1/highr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/highr","6":"FALSE","7":"FALSE","8":"2021-04-16","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"highr"},{"1":"hms","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/hms","5":"C:/Users/tdunn/Documents/R/win-library/4.1/hms","6":"FALSE","7":"FALSE","8":"2021-09-26","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"hms"},{"1":"htmltools","2":"0.5.2","3":"0.5.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/htmltools","5":"C:/Users/tdunn/Documents/R/win-library/4.1/htmltools","6":"FALSE","7":"FALSE","8":"2021-08-25","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"htmltools"},{"1":"httr","2":"1.4.2","3":"1.4.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/httr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/httr","6":"FALSE","7":"FALSE","8":"2020-07-20","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"httr"},{"1":"infer","2":"1.0.0","3":"1.0.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/infer","5":"C:/Users/tdunn/Documents/R/win-library/4.1/infer","6":"TRUE","7":"FALSE","8":"2021-08-13","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"infer"},{"1":"insight","2":"0.17.0","3":"0.17.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/insight","5":"C:/Users/tdunn/Documents/R/win-library/4.1/insight","6":"FALSE","7":"FALSE","8":"2022-03-29","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"insight"},{"1":"ipred","2":"0.9.12","3":"0.9-12","4":"C:/Users/tdunn/Documents/R/win-library/4.1/ipred","5":"C:/Users/tdunn/Documents/R/win-library/4.1/ipred","6":"FALSE","7":"FALSE","8":"2021-09-15","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"ipred"},{"1":"iterators","2":"1.0.14","3":"1.0.14","4":"C:/Users/tdunn/Documents/R/win-library/4.1/iterators","5":"C:/Users/tdunn/Documents/R/win-library/4.1/iterators","6":"TRUE","7":"FALSE","8":"2022-02-05","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"iterators"},{"1":"jquerylib","2":"0.1.4","3":"0.1.4","4":"C:/Users/tdunn/Documents/R/win-library/4.1/jquerylib","5":"C:/Users/tdunn/Documents/R/win-library/4.1/jquerylib","6":"FALSE","7":"FALSE","8":"2021-04-26","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"jquerylib"},{"1":"jsonlite","2":"1.8.0","3":"1.8.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/jsonlite","5":"C:/Users/tdunn/Documents/R/win-library/4.1/jsonlite","6":"FALSE","7":"FALSE","8":"2022-02-22","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"jsonlite"},{"1":"kernlab","2":"0.9.30","3":"0.9-30","4":"C:/Users/tdunn/Documents/R/win-library/4.1/kernlab","5":"C:/Users/tdunn/Documents/R/win-library/4.1/kernlab","6":"FALSE","7":"FALSE","8":"2022-04-02","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"kernlab"},{"1":"knitr","2":"1.37","3":"1.37","4":"C:/Users/tdunn/Documents/R/win-library/4.1/knitr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/knitr","6":"FALSE","7":"FALSE","8":"2021-12-16","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"knitr"},{"1":"labeling","2":"0.4.2","3":"0.4.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/labeling","5":"C:/Users/tdunn/Documents/R/win-library/4.1/labeling","6":"FALSE","7":"FALSE","8":"2020-10-20","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"labeling"},{"1":"lattice","2":"0.20.45","3":"0.20-45","4":"C:/Program Files/R/R-4.2.0/library/lattice","5":"C:/Program Files/R/R-4.2.0/library/lattice","6":"FALSE","7":"FALSE","8":"2021-09-22","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"lattice"},{"1":"lava","2":"1.6.10","3":"1.6.10","4":"C:/Users/tdunn/Documents/R/win-library/4.1/lava","5":"C:/Users/tdunn/Documents/R/win-library/4.1/lava","6":"FALSE","7":"FALSE","8":"2021-09-02","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"lava"},{"1":"lhs","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/lhs","5":"C:/Users/tdunn/Documents/R/win-library/4.1/lhs","6":"FALSE","7":"FALSE","8":"2020-10-05","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"lhs"},{"1":"lifecycle","2":"1.0.1","3":"1.0.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/lifecycle","5":"C:/Users/tdunn/Documents/R/win-library/4.1/lifecycle","6":"FALSE","7":"FALSE","8":"2021-09-24","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"lifecycle"},{"1":"listenv","2":"0.8.0","3":"0.8.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/listenv","5":"C:/Users/tdunn/Documents/R/win-library/4.1/listenv","6":"FALSE","7":"FALSE","8":"2019-12-05","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"listenv"},{"1":"lubridate","2":"1.8.0","3":"1.8.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/lubridate","5":"C:/Users/tdunn/Documents/R/win-library/4.1/lubridate","6":"FALSE","7":"FALSE","8":"2021-10-07","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"lubridate"},{"1":"magrittr","2":"2.0.2","3":"2.0.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/magrittr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/magrittr","6":"FALSE","7":"FALSE","8":"2022-01-26","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"magrittr"},{"1":"MASS","2":"7.3.56","3":"7.3-56","4":"C:/Program Files/R/R-4.2.0/library/MASS","5":"C:/Program Files/R/R-4.2.0/library/MASS","6":"FALSE","7":"FALSE","8":"2022-03-23","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"MASS"},{"1":"Matrix","2":"1.4.1","3":"1.4-1","4":"C:/Program Files/R/R-4.2.0/library/Matrix","5":"C:/Program Files/R/R-4.2.0/library/Matrix","6":"FALSE","7":"FALSE","8":"2022-03-23","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"Matrix"},{"1":"memoise","2":"2.0.1","3":"2.0.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/memoise","5":"C:/Users/tdunn/Documents/R/win-library/4.1/memoise","6":"FALSE","7":"FALSE","8":"2021-11-26","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"memoise"},{"1":"mgcv","2":"1.8.40","3":"1.8-40","4":"C:/Users/tdunn/Documents/R/win-library/4.1/mgcv","5":"C:/Users/tdunn/Documents/R/win-library/4.1/mgcv","6":"TRUE","7":"FALSE","8":"2022-03-29","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"mgcv"},{"1":"modeldata","2":"0.1.1","3":"0.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/modeldata","5":"C:/Users/tdunn/Documents/R/win-library/4.1/modeldata","6":"TRUE","7":"FALSE","8":"2021-07-14","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"modeldata"},{"1":"modelr","2":"0.1.8","3":"0.1.8","4":"C:/Users/tdunn/Documents/R/win-library/4.1/modelr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/modelr","6":"FALSE","7":"FALSE","8":"2020-05-19","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"modelr"},{"1":"modeltime","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/modeltime","5":"C:/Users/tdunn/Documents/R/win-library/4.1/modeltime","6":"FALSE","7":"FALSE","8":"2022-04-07","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"modeltime"},{"1":"munsell","2":"0.5.0","3":"0.5.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/munsell","5":"C:/Users/tdunn/Documents/R/win-library/4.1/munsell","6":"FALSE","7":"FALSE","8":"2018-06-12","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"munsell"},{"1":"nlme","2":"3.1.157","3":"3.1-157","4":"C:/Program Files/R/R-4.2.0/library/nlme","5":"C:/Program Files/R/R-4.2.0/library/nlme","6":"TRUE","7":"FALSE","8":"2022-03-25","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"nlme"},{"1":"nnet","2":"7.3.17","3":"7.3-17","4":"C:/Program Files/R/R-4.2.0/library/nnet","5":"C:/Program Files/R/R-4.2.0/library/nnet","6":"FALSE","7":"FALSE","8":"2022-01-16","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"nnet"},{"1":"parallelly","2":"1.30.0","3":"1.30.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/parallelly","5":"C:/Users/tdunn/Documents/R/win-library/4.1/parallelly","6":"FALSE","7":"FALSE","8":"2021-12-17","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"parallelly"},{"1":"parsnip","2":"0.2.1","3":"0.2.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/parsnip","5":"C:/Users/tdunn/Documents/R/win-library/4.1/parsnip","6":"TRUE","7":"FALSE","8":"2022-03-17","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"parsnip"},{"1":"patchwork","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/patchwork","5":"C:/Users/tdunn/Documents/R/win-library/4.1/patchwork","6":"TRUE","7":"FALSE","8":"2020-12-17","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"patchwork"},{"1":"performance","2":"0.9.0","3":"0.9.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/performance","5":"C:/Users/tdunn/Documents/R/win-library/4.1/performance","6":"FALSE","7":"FALSE","8":"2022-03-30","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"performance"},{"1":"pillar","2":"1.7.0","3":"1.7.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/pillar","5":"C:/Users/tdunn/Documents/R/win-library/4.1/pillar","6":"FALSE","7":"FALSE","8":"2022-02-01","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"pillar"},{"1":"pkgbuild","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/pkgbuild","5":"C:/Users/tdunn/Documents/R/win-library/4.1/pkgbuild","6":"FALSE","7":"FALSE","8":"2020-12-15","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"pkgbuild"},{"1":"pkgconfig","2":"2.0.3","3":"2.0.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/pkgconfig","5":"C:/Users/tdunn/Documents/R/win-library/4.1/pkgconfig","6":"FALSE","7":"FALSE","8":"2019-09-22","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"pkgconfig"},{"1":"pkgload","2":"1.2.1","3":"1.2.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/pkgload","5":"C:/Users/tdunn/Documents/R/win-library/4.1/pkgload","6":"FALSE","7":"FALSE","8":"2021-04-06","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"pkgload"},{"1":"plyr","2":"1.8.7","3":"1.8.7","4":"C:/Users/tdunn/Documents/R/win-library/4.1/plyr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/plyr","6":"FALSE","7":"FALSE","8":"2022-03-24","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"plyr"},{"1":"poissonreg","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/poissonreg","5":"C:/Users/tdunn/Documents/R/win-library/4.1/poissonreg","6":"TRUE","7":"FALSE","8":"2022-03-09","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"poissonreg"},{"1":"prettyunits","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/prettyunits","5":"C:/Users/tdunn/Documents/R/win-library/4.1/prettyunits","6":"FALSE","7":"FALSE","8":"2020-01-24","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"prettyunits"},{"1":"pROC","2":"1.17.0.1","3":"1.17.0.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/pROC","5":"C:/Users/tdunn/Documents/R/win-library/4.1/pROC","6":"FALSE","7":"FALSE","8":"2021-01-13","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"pROC"},{"1":"processx","2":"3.5.2","3":"3.5.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/processx","5":"C:/Users/tdunn/Documents/R/win-library/4.1/processx","6":"FALSE","7":"FALSE","8":"2021-04-30","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"processx"},{"1":"prodlim","2":"2019.11.13","3":"2019.11.13","4":"C:/Users/tdunn/Documents/R/win-library/4.1/prodlim","5":"C:/Users/tdunn/Documents/R/win-library/4.1/prodlim","6":"FALSE","7":"FALSE","8":"2019-11-17","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"prodlim"},{"1":"ps","2":"1.6.0","3":"1.6.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/ps","5":"C:/Users/tdunn/Documents/R/win-library/4.1/ps","6":"FALSE","7":"FALSE","8":"2021-02-28","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"ps"},{"1":"purrr","2":"0.3.4","3":"0.3.4","4":"C:/Users/tdunn/Documents/R/win-library/4.1/purrr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/purrr","6":"TRUE","7":"FALSE","8":"2020-04-17","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"purrr"},{"1":"R6","2":"2.5.1","3":"2.5.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/R6","5":"C:/Users/tdunn/Documents/R/win-library/4.1/R6","6":"FALSE","7":"FALSE","8":"2021-08-19","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"R6"},{"1":"ranger","2":"0.13.1","3":"0.13.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/ranger","5":"C:/Users/tdunn/Documents/R/win-library/4.1/ranger","6":"FALSE","7":"FALSE","8":"2021-07-14","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"ranger"},{"1":"Rcpp","2":"1.0.8.3","3":"1.0.8.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/Rcpp","5":"C:/Users/tdunn/Documents/R/win-library/4.1/Rcpp","6":"FALSE","7":"FALSE","8":"2022-03-17","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"Rcpp"},{"1":"RcppParallel","2":"5.1.4","3":"5.1.4","4":"C:/Users/tdunn/Documents/R/win-library/4.1/RcppParallel","5":"C:/Users/tdunn/Documents/R/win-library/4.1/RcppParallel","6":"FALSE","7":"FALSE","8":"2021-05-04","9":"CRAN (R 4.1.2)","10":"FALSE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"RcppParallel"},{"1":"readr","2":"2.1.1","3":"2.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/readr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/readr","6":"TRUE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"readr"},{"1":"readxl","2":"1.3.1","3":"1.3.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/readxl","5":"C:/Users/tdunn/Documents/R/win-library/4.1/readxl","6":"FALSE","7":"FALSE","8":"2019-03-13","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"readxl"},{"1":"recipes","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/recipes","5":"C:/Users/tdunn/Documents/R/win-library/4.1/recipes","6":"TRUE","7":"FALSE","8":"2022-02-18","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"recipes"},{"1":"remotes","2":"2.4.2","3":"2.4.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/remotes","5":"C:/Users/tdunn/Documents/R/win-library/4.1/remotes","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"remotes"},{"1":"reprex","2":"2.0.0","3":"2.0.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/reprex","5":"C:/Users/tdunn/Documents/R/win-library/4.1/reprex","6":"FALSE","7":"FALSE","8":"2021-04-02","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"reprex"},{"1":"rlang","2":"1.0.2","3":"1.0.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rlang","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rlang","6":"FALSE","7":"FALSE","8":"2022-03-04","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rlang"},{"1":"rmarkdown","2":"2.11","3":"2.11","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rmarkdown","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rmarkdown","6":"FALSE","7":"FALSE","8":"2021-09-14","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rmarkdown"},{"1":"rpart","2":"4.1.16","3":"4.1.16","4":"C:/Program Files/R/R-4.2.0/library/rpart","5":"C:/Program Files/R/R-4.2.0/library/rpart","6":"FALSE","7":"FALSE","8":"2022-01-24","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"rpart"},{"1":"rpart.plot","2":"3.1.0","3":"3.1.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rpart.plot","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rpart.plot","6":"FALSE","7":"FALSE","8":"2021-07-24","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rpart.plot"},{"1":"rprojroot","2":"2.0.2","3":"2.0.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rprojroot","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rprojroot","6":"FALSE","7":"FALSE","8":"2020-11-15","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rprojroot"},{"1":"rsample","2":"0.1.1","3":"0.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rsample","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rsample","6":"TRUE","7":"FALSE","8":"2021-11-08","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rsample"},{"1":"rstudioapi","2":"0.13","3":"0.13","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rstudioapi","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rstudioapi","6":"FALSE","7":"FALSE","8":"2020-11-12","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rstudioapi"},{"1":"Rttf2pt1","2":"1.3.8","3":"1.3.8","4":"C:/Users/tdunn/Documents/R/win-library/4.1/Rttf2pt1","5":"C:/Users/tdunn/Documents/R/win-library/4.1/Rttf2pt1","6":"FALSE","7":"FALSE","8":"2020-01-10","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"Rttf2pt1"},{"1":"rvest","2":"1.0.0","3":"1.0.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/rvest","5":"C:/Users/tdunn/Documents/R/win-library/4.1/rvest","6":"FALSE","7":"FALSE","8":"2021-03-09","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"rvest"},{"1":"sass","2":"0.4.0","3":"0.4.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/sass","5":"C:/Users/tdunn/Documents/R/win-library/4.1/sass","6":"FALSE","7":"FALSE","8":"2021-05-12","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"sass"},{"1":"scales","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/scales","5":"C:/Users/tdunn/Documents/R/win-library/4.1/scales","6":"TRUE","7":"FALSE","8":"2022-04-13","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"scales"},{"1":"sessioninfo","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/sessioninfo","5":"C:/Users/tdunn/Documents/R/win-library/4.1/sessioninfo","6":"FALSE","7":"FALSE","8":"2018-11-05","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"sessioninfo"},{"1":"slider","2":"0.2.2","3":"0.2.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/slider","5":"C:/Users/tdunn/Documents/R/win-library/4.1/slider","6":"FALSE","7":"FALSE","8":"2021-07-01","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"slider"},{"1":"StanHeaders","2":"2.21.0.7","3":"2.21.0-7","4":"C:/Users/tdunn/Documents/R/win-library/4.1/StanHeaders","5":"C:/Users/tdunn/Documents/R/win-library/4.1/StanHeaders","6":"FALSE","7":"FALSE","8":"2020-12-17","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"StanHeaders"},{"1":"stringi","2":"1.7.6","3":"1.7.6","4":"C:/Users/tdunn/Documents/R/win-library/4.1/stringi","5":"C:/Users/tdunn/Documents/R/win-library/4.1/stringi","6":"FALSE","7":"FALSE","8":"2021-11-29","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"stringi"},{"1":"stringr","2":"1.4.0","3":"1.4.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/stringr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/stringr","6":"TRUE","7":"FALSE","8":"2019-02-10","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"stringr"},{"1":"survival","2":"3.3.1","3":"3.3-1","4":"C:/Program Files/R/R-4.2.0/library/survival","5":"C:/Program Files/R/R-4.2.0/library/survival","6":"FALSE","7":"FALSE","8":"2022-03-03","9":"CRAN (R 4.2.0)","10":"NA","11":"C:/Program Files/R/R-4.2.0/library","_rn_":"survival"},{"1":"testthat","2":"3.1.1","3":"3.1.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/testthat","5":"C:/Users/tdunn/Documents/R/win-library/4.1/testthat","6":"FALSE","7":"FALSE","8":"2021-12-03","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"testthat"},{"1":"tibble","2":"3.1.6","3":"3.1.6","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tibble","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tibble","6":"TRUE","7":"FALSE","8":"2021-11-07","9":"CRAN (R 4.1.1)","10":"NA","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tibble"},{"1":"tictoc","2":"1.0.1","3":"1.0.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tictoc","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tictoc","6":"TRUE","7":"FALSE","8":"2021-04-19","9":"CRAN (R 4.1.1)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tictoc"},{"1":"tidymodels","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tidymodels","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tidymodels","6":"TRUE","7":"FALSE","8":"2022-03-19","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tidymodels"},{"1":"tidyr","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tidyr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tidyr","6":"TRUE","7":"FALSE","8":"2022-02-01","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tidyr"},{"1":"tidyselect","2":"1.1.2","3":"1.1.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tidyselect","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tidyselect","6":"FALSE","7":"FALSE","8":"2022-02-21","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tidyselect"},{"1":"tidyverse","2":"1.3.1","3":"1.3.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tidyverse","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tidyverse","6":"TRUE","7":"FALSE","8":"2021-04-15","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tidyverse"},{"1":"timeDate","2":"3043.102","3":"3043.102","4":"C:/Users/tdunn/Documents/R/win-library/4.1/timeDate","5":"C:/Users/tdunn/Documents/R/win-library/4.1/timeDate","6":"TRUE","7":"FALSE","8":"2018-02-21","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"timeDate"},{"1":"tune","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tune","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tune","6":"TRUE","7":"FALSE","8":"2022-03-19","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tune"},{"1":"tzdb","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/tzdb","5":"C:/Users/tdunn/Documents/R/win-library/4.1/tzdb","6":"FALSE","7":"FALSE","8":"2021-10-27","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"tzdb"},{"1":"usethis","2":"2.1.5","3":"2.1.5","4":"C:/Users/tdunn/Documents/R/win-library/4.1/usethis","5":"C:/Users/tdunn/Documents/R/win-library/4.1/usethis","6":"FALSE","7":"FALSE","8":"2021-12-09","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"usethis"},{"1":"utf8","2":"1.2.2","3":"1.2.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/utf8","5":"C:/Users/tdunn/Documents/R/win-library/4.1/utf8","6":"FALSE","7":"FALSE","8":"2021-07-24","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"utf8"},{"1":"vctrs","2":"0.4.1","3":"0.4.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/vctrs","5":"C:/Users/tdunn/Documents/R/win-library/4.1/vctrs","6":"FALSE","7":"FALSE","8":"2022-04-13","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"vctrs"},{"1":"vip","2":"0.3.2","3":"0.3.2","4":"C:/Users/tdunn/Documents/R/win-library/4.1/vip","5":"C:/Users/tdunn/Documents/R/win-library/4.1/vip","6":"TRUE","7":"FALSE","8":"2020-12-17","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"vip"},{"1":"viridisLite","2":"0.4.0","3":"0.4.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/viridisLite","5":"C:/Users/tdunn/Documents/R/win-library/4.1/viridisLite","6":"FALSE","7":"FALSE","8":"2021-04-13","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"viridisLite"},{"1":"warp","2":"0.2.0","3":"0.2.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/warp","5":"C:/Users/tdunn/Documents/R/win-library/4.1/warp","6":"FALSE","7":"FALSE","8":"2020-10-21","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"warp"},{"1":"withr","2":"2.5.0","3":"2.5.0","4":"C:/Users/tdunn/Documents/R/win-library/4.1/withr","5":"C:/Users/tdunn/Documents/R/win-library/4.1/withr","6":"FALSE","7":"FALSE","8":"2022-03-03","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"withr"},{"1":"workflows","2":"0.2.6","3":"0.2.6","4":"C:/Users/tdunn/Documents/R/win-library/4.1/workflows","5":"C:/Users/tdunn/Documents/R/win-library/4.1/workflows","6":"TRUE","7":"FALSE","8":"2022-03-18","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"workflows"},{"1":"workflowsets","2":"0.2.1","3":"0.2.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/workflowsets","5":"C:/Users/tdunn/Documents/R/win-library/4.1/workflowsets","6":"TRUE","7":"FALSE","8":"2022-03-15","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"workflowsets"},{"1":"xfun","2":"0.29","3":"0.29","4":"C:/Users/tdunn/Documents/R/win-library/4.1/xfun","5":"C:/Users/tdunn/Documents/R/win-library/4.1/xfun","6":"FALSE","7":"FALSE","8":"2021-12-14","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"xfun"},{"1":"xgboost","2":"1.6.0.1","3":"1.6.0.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/xgboost","5":"C:/Users/tdunn/Documents/R/win-library/4.1/xgboost","6":"FALSE","7":"FALSE","8":"2022-04-16","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"xgboost"},{"1":"xml2","2":"1.3.3","3":"1.3.3","4":"C:/Users/tdunn/Documents/R/win-library/4.1/xml2","5":"C:/Users/tdunn/Documents/R/win-library/4.1/xml2","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.1.2)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"xml2"},{"1":"yaml","2":"2.2.1","3":"2.2.1","4":"C:/Users/tdunn/Documents/R/win-library/4.1/yaml","5":"C:/Users/tdunn/Documents/R/win-library/4.1/yaml","6":"FALSE","7":"FALSE","8":"2020-02-01","9":"CRAN (R 4.1.0)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"yaml"},{"1":"yardstick","2":"0.0.9","3":"0.0.9","4":"C:/Users/tdunn/Documents/R/win-library/4.1/yardstick","5":"C:/Users/tdunn/Documents/R/win-library/4.1/yardstick","6":"TRUE","7":"FALSE","8":"2021-11-22","9":"CRAN (R 4.1.3)","10":"TRUE","11":"C:/Users/tdunn/Documents/R/win-library/4.1","_rn_":"yardstick"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</details>
<details>
<summary>
Git repository
</summary>
<div class="layout-chunk" data-layout="l-body">
<pre><code>Local:    main C:/Users/tdunn/Documents/tdunn
Remote:   main @ origin (https://github.com/taylordunn/tdunn)
Head:     [6d376fb] 2022-05-28: Merge pull request #5 from taylordunn/bike-ridership</code></pre>
</div>
</details>
<div class="layout-chunk" data-layout="l-body">
<p><a href="https://github.com/taylordunn/tdunn/tree/main/_posts/">Source code</a></p>
</div>
<div class="sourceCode" id="cb16"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent"
role="doc-bibliography">
<div id="ref-Hyndman2006" class="csl-entry" role="doc-biblioentry">
Hyndman, Rob J, and Anne B Koehler. 2006. <span>“Another Look at
Measures of Forecast Accuracy.”</span> <em>International Journal of
Forecasting</em> 22 (4): 679–88.
</div>
</div>
<section class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Since
<code>initial_time_split()</code> doesn’t take <code>strata</code>
argument, this would require defining a custom split function with
<code>rsample::make_splits()</code>. This functionality might be
available in future versions of <code>rsample</code> (see <a
href="https://github.com/tidymodels/rsample/issues/207">this
issue</a>).<a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Check out <a
href="https://fromthebottomoftheheap.net/2014/05/09/modelling-seasonal-data-with-gam/">this
blog post by Gavin Simpson</a> for a great walkthrough of modeling
seasonal data with GAMs.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Using the
<code>select_best = TRUE</code> argument means only the best model in
each workflow is returned. In this case, that means the workflows with
the tunable spline feature of <code>count_date_doy</code> will only have
one entry.<a href="#fnref3" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>You could make the argument that the
improvement is so minor that it is worth choosing the simpler linear
regression model instead.<a href="#fnref4" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>This is my reminder to myself to come
back in fall 2022 to see how the model performs on a full summer
season.<a href="#fnref5" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
